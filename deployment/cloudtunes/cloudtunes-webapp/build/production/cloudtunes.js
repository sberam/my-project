!function(){"use strict";var t="undefined"!=typeof window?window:global;if("function"!=typeof t.require){var e={},r={},n=function(t,e){return{}.hasOwnProperty.call(t,e)},i=function(t,e){var r,n,i=[];r=/^\.\.?(\/|$)/.test(e)?[t,e].join("/").split("/"):e.split("/");for(var s=0,o=r.length;o>s;s++)n=r[s],".."===n?i.pop():"."!==n&&""!==n&&i.push(n);return i.join("/")},s=function(t){return t.split("/").slice(0,-1).join("/")},o=function(e){return function(r){var n=s(e),o=i(n,r);return t.require(o,e)}},a=function(t,e){var n={id:t,exports:{}};return r[t]=n,e(n.exports,o(t),n),n.exports},u=function(t,s){var o=i(t,".");if(null==s&&(s="/"),n(r,o))return r[o].exports;if(n(e,o))return a(o,e[o]);var u=i(o,"./index");if(n(r,u))return r[u].exports;if(n(e,u))return a(u,e[u]);throw new Error('Cannot find module "'+t+'" from "'+s+'"')},p=function(t,r){if("object"==typeof t)for(var i in t)n(t,i)&&(e[i]=t[i]);else e[t]=r},l=function(){var t=[];for(var r in e)n(e,r)&&t.push(r);return t};t.require=u,t.require.define=p,t.require.register=p,t.require.list=l,t.require.brunch=!0}}(),require.register("application",function(t,e,r){var n,i,s,o,a,u,p,l,c,h,d,f,y,m,g;n=e("jquery"),g=e("pubsub"),m=e("notifications"),h=e("router"),f=e("models/user"),a=e("models/library_state"),y=e("models/user_library"),d=e("models/sidebar"),c=e("models/lists/playlists").PlayQueuePlaylist,o=e("views/layout_view"),u=e("views/sidebars/nav_sidebar_view"),s=e("views/sidebars/info_sidebar_view"),l="▶",p="❚❚",i=function(){function t(){}return t.prototype.initialize=function(){return this.user=g.user=new f,this.user.library=new y,this.libraryState=new a(null,{library:this.user.library}),this.navSidebar=g.navSidebar=new d({width:150}),this.infoSidebar=g.infoSidebar=new d({width:250}),this.initLayout(),this.pubsub=g,g.user=this.user,g.libraryState=this.libraryState,g.router=new h,this.user.fetch({success:function(t){return function(){return t.libraryState.library.fetch({reset:!0}).then(function(){return Backbone.history.start({pushState:!0}),io.connect("http:///sync").on("user:change",function(e){return t.user.set(JSON.parse(e))})})}}(this)}),this.initPlayer(),this.initSidebars(),n(window).on("beforeunload",function(t){return function(){return t.user.get("confirm_exit")&&t.player.playing()?"CloudTunes music is still playing, do you really want to leave?":void 0}}(this))},t.prototype.initLayout=function(){return new o({el:n(document.body)}).render()},t.prototype.initSidebars=function(){return new u({model:this.navSidebar,el:n("#nav-sidebar")}).render(),new s({model:this.infoSidebar,el:n("#info-sidebar")}).render()},t.prototype.initPlayer=function(){var t,r,i;return t=e("models/player"),r=e("views/player_view"),this.player=g.player=new t,i=io.connect("http:///player"),io.connect("http:///remote").on("play_artist",function(t){return function(e){var r;return r=t.user.library.playlists.at(0).getChild(),r.criteria.set({artist:e}),t.player.replaceQueue(r.getTracks()),t.player.play()}}(this)).on("play_pause",function(t){return function(){return t.player.toggle()}}(this)).on("play",function(t){return function(e){var r;return e&&(r=t.user.library.get(e)),t.player.play(r)}}(this)).on("clear",function(t){return function(){return t.player.queue.clear(),t.player.stop()}}(this)).on("queue",function(t){return function(e){var r;return r=t.user.library.playlists.at(e),t.player.replaceQueue(r.getTracks())}}(this)).on("select",function(t){return function(e){var r;return r=t.user.library.playlists.at(e),r?r.collection.selected(r):void 0}}(this)).on("pause",function(t){return function(){return t.player.pause()}}(this)).on("prev",function(t){return function(){return t.player.prev()}}(this)).on("next",function(t){return function(){return t.player.next()}}(this)),new r({model:this.player,el:n("#player")}).render(),this.user.library.playlists.unshift(new c({id:"queue",parent:this.player.queue,name:"Play Queue"})),this.player.on("change:state",function(t){return function(){var e;return t.player.playing()&&(e=t.player.get("track"),e!==t.player.previous("track"))?i.emit("play",{track_dict:e}):void 0}}(this)).on("change:state",function(t){return function(){var e,r;return t.player.playing()&&g.user.get("desktop_notifications")?(r=t.player.get("track"),e="",r.get("album")&&(e+=" from "+r.get("album")),m({title:"☁♪ Now Playing",body:""+r.get("artist")+" – "+r.get("title")})):void 0}}(this)).on("change:state",function(t){return function(){var e,r;return r=t.player.get("track"),r?(e=t.player.playing()?l:p,document.title=""+e+" "+r.get("title")+" – "+r.get("artist")):document.title="cloudtunes"}}(this))},t}(),r.exports=i}),require.register("main",function(t,e){var r,n,i;i=e("pubsub"),r=e("application"),n=e("backbone"),window.WEB_SOCKET_DEBUG=!0,window.WEB_SOCKET_SWF_LOCATION="/static/socketio/WebSocketMain.swf",window.soundManager.setup({url:"/static/soundmanager/",onready:function(){}}),n.urlRoot="/api/","#_=_"===window.location.hash&&(window.location.hash="",history.pushState("",document.title,window.location.pathname)),$(function(){var t;return t=new r,window.app=t,t.initialize()})}),require.register("models/library_state",function(t,e,r){var n,i,s,o,a,u,p,l,c,h,d=function(t,e){return function(){return t.apply(e,arguments)}},f={}.hasOwnProperty,y=function(t,e){function r(){this.constructor=t}for(var n in e)f.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};c=e("pubsub"),o=e("mvc").Model,l=e("models/user_library"),h=e("models/lists/virtual"),n=h.AlbumNameList,i=h.ArtistNameList,p=e("models/lists/tracklist"),a=e("models/lists/states").Ordering,u={d:"Dropbox",y:"YouTube"},s=function(t){function e(){return this.selectTrack=d(this.selectTrack,this),this.selectAlbum=d(this.selectAlbum,this),this.selectArtist=d(this.selectArtist,this),this.updateLists=d(this.updateLists,this),this.setPlaylist=d(this.setPlaylist,this),e.__super__.constructor.apply(this,arguments)}return y(e,t),e.prototype.defaults={playlist:null,artist:null,album:null,track:null,sortBy:"artist",ordering:"asc",centerY:25,centerX:35,trackColumns:[5,32,32]},e.prototype.initialize=function(t,e){return this.library=e.library,this.library.playlists.on("change:selected",function(t){return function(e){return e.get("selected")?t.setPlaylist(e):void 0}}(this)),this.library.playlists.selected(this.library.playlists.first()),this.library.on("reset",function(t){return function(){return t.library.playlists.selected(t.library.playlists.first())}}(this)),this.on("change:artist change:album change:sortBy change:ordering",function(t){return function(){return t.updateLists()}}(this)),this.library.on("all",function(t){return function(){return t.trigger("tracks:"+arguments[0],_.toArray(arguments).slice(1))}}(this)),c.on("select:artist",this.selectArtist).on("select:album",this.selectAlbum).on("select:track",this.selectTrack),io.connect("http:///sync").on("track:add",function(t){return function(e){return t.library.add(JSON.parse(e))}}(this)).on("track:change",function(t){return function(e){return t.library.add(JSON.parse(e))}}(this)).on("track:remove",function(t){return function(e){var r;return r=t.library.byId[e],r?t.library.remove(r):void 0}}(this)).on("dropbox:reset",function(t){return function(){return t.library.remove(t.library.where({source:"d"}),{silent:!0}),t.library.trigger("reset")}}(this))},e.prototype.getPlaylist=function(){return this.get("playlist")},e.prototype.getArtistList=function(){return this.getPlaylist().children.artists},e.prototype.getAlbumList=function(){return this.getPlaylist().children.albums},e.prototype.getTrackList=function(){return this.getPlaylist().children.tracks},e.prototype.setPlaylist=function(t){return t.children||(t.children={artists:t.getArtistList(),albums:t.getAlbumList(),tracks:t.getChild()}),this.set("playlist",t)},e.prototype.updateLists=function(){var t;return console.log("updateLists"),t=this.getPlaylist(),t.children?(t.children.albums.criteria.set({artist:this.get("artist")}),t.children.tracks.criteria.set({artist:this.get("artist"),album:this.get("album")}),t.children.tracks.ordering.set({field:this.get("sortBy"),direction:this.get("ordering")})):void 0},e.prototype.selectArtist=function(t){return null==t&&(t=null),console.log("selectArtist",t),this.set(t?{artist:t.get("artist"),album:null,track:t}:{artist:null})},e.prototype.selectAlbum=function(t){return null==t&&(t=null),this.set(t?{artist:t.get("artist"),album:t.get("album"),track:t}:{album:null})},e.prototype.selectTrack=function(t){return null==t&&(t=null),this.set({track:t,artist:t.get("artist"),album:t.get("album")})},e.prototype.toggleOrdering=function(){return this.set("ordering",this.get("ordering")===a.ASC?a.DESC:a.ASC)},e}(o),r.exports=s}),require.register("models/lists/base",function(t,e,r){var n,i,s,o,a,u,p,l=function(t,e){return function(){return t.apply(e,arguments)}},c={}.hasOwnProperty,h=function(t,e){function r(){this.constructor=t}for(var n in e)c.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};u=e("underscore"),a=e("pubsub"),s=e("mvc").Model,p=e("models/lists/states"),i=p.Criteria,o=p.Ordering,n=function(t){function e(t,r){this._proxyRemove=l(this._proxyRemove,this),this._proxyChange=l(this._proxyChange,this),this._proxyAdd=l(this._proxyAdd,this),this.reset=l(this.reset,this);var n;if(!t.parent)throw"MISSING PARENT LIST";n=[t.parent,t.criteria||new this.Criteria,t.ordering||new this.Ordering],this.parent=n[0],this.criteria=n[1],this.ordering=n[2],e.__super__.constructor.call(this,u.omit(t,"parent","criteria","ordering"),r),this.listenTo(this.criteria,"change",this.reset),this.listenTo(this.ordering,"change",this.reset),this.listenTo(this.parent,"reset add change remove",this.reset)}return h(e,t),e.prototype.namespace=null,e.prototype.parent=null,e.prototype.criteria=null,e.prototype.ordering=null,e.prototype.cachedResult=null,e.prototype.Criteria=i,e.prototype.Ordering=o,e.prototype.reset=function(){return this.cachedResult=null,this.trigger("reset")},e.prototype.close=function(){return this.parent.off(null,null,this)},e.prototype.getTracks=function(){return this.criteria.apply(this.parent.getTracks())},e.prototype.getResult=function(){return this.cachedResult||(this.cachedResult=this._getResult()),this.cachedResult},e.prototype.clone=function(){var t;return t=u.extend({},this.attributes,{parent:this.parent,criteria:this.criteria.clone(),ordering:this.ordering.clone()}),new this.constructor(t)},e.prototype._getResult=function(){return this.ordering.apply(this._getValues(this.getTracks()))},e.prototype._includes=function(t){return u.include(this.getResult(),this._getValue(t))},e.prototype._getValue=function(){throw"NOT IMPLEMENTED"},e.prototype._getValues=function(){throw"NOT IMPLEMENTED"},e.prototype._proxyAdd=function(t){var e;return console.log("_proxyAdd",this.criteria.matches(t),this,t),this.criteria.matches(t)?(e=this._add(t),this.trigger("add",t,e),this.trigger(this.namespace+":add",t)):void 0},e.prototype._proxyChange=function(t){var e;return this._includes(t)?(e=u.indexOf(this.cachedResult,this._getValue(t)),this.trigger("change",t,e),this.trigger(this.namespace+":change",t)):void 0},e.prototype._proxyRemove=function(t){var e;return this._includes(t)?(e=this._remove(t),this.trigger("remove",t,e),this.trigger(this.namespace+":remove",t)):void 0},e.prototype._add=function(t){var e;return this.getResult(),e=this.ordering.getSortedIndex(this.cachedResult,this._getValue(t)),this.cachedResult.splice(e,0,this._getValue(t)),e},e.prototype._remove=function(t){var e;return this.getResult(),e=u.indexOf(this.cachedResult,this._getValue(t)),this.cachedResult.splice(e,1),e},e}(s),r.exports=n}),require.register("models/lists/play_queue",function(t,e,r){var n,i,s,o,a;n=e("backbone"),a=e("underscore"),i=e("models/lists/states").NullOrdering,o=e("models/lists/tracklist"),s=function(){function t(){this.tracks=[],this.clear()}return a.extend(t.prototype,n.Events),t.prototype.len=function(){return this.tracks.length},t.prototype.getCurrent=function(){return this.tracks[this.index]},t.prototype.setCurrent=function(t){var e;if(e=a.indexOf(this.tracks,t),-1===e)throw"Track not in queue!";return this.index=e},t.prototype.hasNext=function(){return this.len()&&this.len()>this.index+1},t.prototype.hasPrev=function(){return this.index>0},t.prototype.next=function(){return this.hasNext()?this.tracks[++this.index]:void 0},t.prototype.prev=function(){return this.hasPrev()?this.tracks[--this.index]:void 0},t.prototype.rewind=function(){return this.index=0},t.prototype.clear=function(t){return null==t&&(t={silent:!1}),this.rewind(),this.tracks.length=0,t.silent?void 0:this.trigger("reset")},t.prototype.replace=function(t){return this.clear({silent:!0}),this.add(t),this.trigger("reset")},t.prototype.add=function(t){return Array.prototype.push.apply(this.tracks,t),this.trigger("reset")},t.prototype.remove=function(){},t.prototype.move=function(t,e){var r;if(console.log("moving",t.get("title"),"to",e),r=a.indexOf(this.tracks,t),-1===r)throw"cannot move track; not in queue";return r===e?void console.log("no change"):(this.tracks.splice(r,1),e>r&&(e-=1),console.log("@tracks.splice(",e,"0",t,")"),this.tracks.splice(e,0,t),this.trigger("reset"))},t.prototype.getTracks=function(){return[].concat(this.tracks)},t.prototype.getResult=function(){return this.getTracks()},t}(),r.exports=s}),require.register("models/lists/playlists",function(t,e,r){var n,i,s,o,a,u,p,l,c,h={}.hasOwnProperty,d=function(t,e){function r(){this.constructor=t}for(var n in e)h.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};i=e("mvc").Collection,c=e("pubsub"),p=e("models/lists/tracklist"),s=e("models/lists/states").NullOrdering,a=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return d(e,t),e.prototype.getRoute=function(){return"/playlist/"+this.id},e.prototype.acceptsTracks=function(){return!1},e.prototype.canRename=function(){return!1},e.prototype.canDelete=function(){return!1},e}(p),l=function(t){function e(t,r){var n;t.parent=c.user.library,n=t.tracks||[],delete t.tracks,e.__super__.constructor.call(this,t,r),this.criteria.set("id",n)}return d(e,t),e.prototype.editable=!0,e.prototype.defaults={icon:"music"},e.prototype.acceptsTracks=function(){return!0},e.prototype.canRename=function(){return!0},e.prototype.canDelete=function(){return!0},e.prototype.addTracks=function(t){return c.user.library.ensureIncluded(t).done(function(e){return function(){var r,n;return n=e.criteria.get("id"),r=_.pluck(t,"id"),r=_.difference(r,n),r.length?(e.criteria.set({id:r.concat(n)}),e._updateTracks(r,"add")):void 0}}(this))},e.prototype.removeTracks=function(t){var e,r;return e=this.criteria.get("id"),r=_.pluck(t,"id"),r=_.intersection(r,e),r.length?(this.criteria.set("id",_.without(e,r)),this._updateTracks(r,"remove")):void 0},e.prototype._updateTracks=function(t,e){return $.ajax({url:this.url()+"/tracks/"+e,type:"POST",dataType:"json",contentType:"application/json",data:JSON.stringify(t)})},e}(a),o=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return d(e,t),e.prototype.defaults={icon:"list-ol"},e.prototype.Ordering=s,e.prototype.acceptsTracks=function(){return!0},e.prototype.getRoute=function(){return"/queue"},e.prototype.getChild=function(){return this},e.prototype.addTracks=function(t){return this.parent.add(t)},e}(a),n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return d(e,t),e.prototype.defaults={icon:"globe"},e.prototype.acceptsTracks=function(){return!0},e.prototype.getRoute=function(){return"/collection"},e.prototype.addTracks=function(t){return this.parent.ensureIncluded(t)},e}(a),u=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return d(e,t),e.prototype.model=l,e.prototype.url="/api/library/playlists",e.prototype.selected=function(t){var e;return null==t&&(t=null),t?(null!=(e=this.selected())&&e.set({selected:!1},{silent:!0}),t.set("selected",!0)):this.findWhere({selected:!0})},e}(i),r.exports={Playlist:a,Playlists:u,PlayQueuePlaylist:o,AllPlaylist:n,UserPlaylist:l}}),require.register("models/lists/states",function(t,e,r){var n,i,s,o,a,u,p=function(t,e){return function(){return t.apply(e,arguments)}},l={}.hasOwnProperty,c=function(t,e){function r(){this.constructor=t}for(var n in e)l.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};i=e("mvc").Model,u=e("underscore"),n=function(t){function e(){return this.matches=p(this.matches,this),e.__super__.constructor.apply(this,arguments)}return c(e,t),e.prototype.apply=function(t){return this.hasRules()&&(t=u.filter(t,this.matches)),t},e.prototype.matches=function(t){var e,r,n,i;i=this.attributes;for(e in i)if(r=i[e],n=t.get(e),null!==r&&!(u.isArray(r)&&u.contains(r,n)||r===n))return!1;return!0},e.prototype.hasRules=function(){return Boolean(u.compact(u.values(this.attributes)).length)},e}(i),s=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return c(e,t),e.prototype.apply=u.identity,e}(i),o=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return c(e,t),e.ASC="asc",e.DESC="desc",e.prototype.defaults={direction:e.ASC},e.prototype.apply=function(t){return t=this._sortAscending(t),this.get("direction")===e.DESC&&t.reverse(),t},e.prototype.getSortedIndex=function(t,e){return u.sortedIndex(t,e,this._getComparator())},e.prototype._sortAscending=function(t){return t.sort()},e.prototype._getComparator=function(){return function(t){return console.log(t),t.toLowerCase()}},e}(s),a=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return c(e,t),e.prototype.defaults=u.extend({field:"artist"},o.prototype.defaults),e.prototype._sortAscending=function(t){return u.sortBy(t,this._getComparator())},e.prototype._getComparator=function(){var t,e,r;switch(r=["0000","000","00","0"],e=function(t){return r[String(t.get("number")).length]+t.get("number")},this.get("field")){case"artist":return function(t){return[t.get("artist").toLowerCase(),t.get("album").toLowerCase(),e(t),t.get("title").toLowerCase()].join("|")};case"album":return function(t){return[t.get("album").toLowerCase(),e(t),t.get("title").toLowerCase()].join("|")};default:return t=this.get("field"),"number"!==t?function(e){return e.get(t).toLowerCase()}:function(e){return e.get(t)}}},e}(o),r.exports={Criteria:n,NullOrdering:s,Ordering:o,TrackOrdering:a}}),require.register("models/lists/tracklist",function(t,e,r){var n,i,s,o,a,u,p={}.hasOwnProperty,l=function(t,e){function r(){this.constructor=t}for(var n in e)p.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};s=e("models/lists/base"),u=e("models/lists/virtual"),n=u.AlbumNameList,i=u.ArtistNameList,a=e("models/lists/states").TrackOrdering,o=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return l(e,t),e.prototype.namespace="track",e.prototype.Ordering=a,e.prototype.acceptsTracks=function(){return!1},e.prototype.getChild=function(){return new e({parent:this})},e.prototype.getAlbumList=function(){return new n({parent:this})},e.prototype.getArtistList=function(){return new i({parent:this})},e.prototype._getValue=_.identity,e.prototype._getValues=_.identity,e}(s),r.exports=o}),require.register("models/lists/virtual",function(t,e,r){var n,i,s,o,a=function(t,e){return function(){return t.apply(e,arguments)}},u={}.hasOwnProperty,p=function(t,e){function r(){this.constructor=t}for(var n in e)u.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};s=e("models/lists/base"),o=function(t){function e(){return this._getValue=a(this._getValue,this),e.__super__.constructor.apply(this,arguments)}return p(e,t),e.prototype._getValue=function(t){return t.get(this.namespace)},e.prototype._getValues=function(t){return _.unique(_.map(t,this._getValue))},e}(s),n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return p(e,t),e.prototype.namespace="album",e}(o),i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return p(e,t),e.prototype.namespace="artist",e}(o),r.exports={AlbumNameList:n,ArtistNameList:i}}),require.register("models/mb/album",function(t,e,r){var n,i,s,o,a,u,p={}.hasOwnProperty,l=function(t,e){function r(){this.constructor=t}for(var n in e)p.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};u=e("mvc"),a=u.Model,n=u.Collection,o=e("models/mb/track").MBTracks,i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return l(e,t),e.prototype.initialize=function(){return this.tracks=new o(this)},e.prototype.getCloudtunesTracks=function(){var t;return t=new $.Deferred,$.when(this.tracks.ensureFetched()).then(function(e){return function(){var r;return r=e.tracks.map(function(t){return t.videos.fetch()}),$.when.apply(null,r).done(function(){var r;return r=_.compact(e.tracks.map(function(t){var e;return null!=(e=t.videos.first())?e.toCloudtunesTrack():void 0})),t.resolve(r)})}}(this)),t.promise()},e.prototype.getDragged=e.prototype.getCloudtunesTracks,e}(a),s=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return l(e,t),e.prototype.model=i,e.prototype.initialize=function(t){this.artist=t},e.prototype.parse=function(t){var e,r,n;for(r=0,n=t.length;n>r;r++)e=t[r],e.artist=this.artist;return t},e}(n),r.exports={MBAlbums:s}}),require.register("models/mb/artist",function(t,e,r){var n,i,s,o,a,u,p,l={}.hasOwnProperty,c=function(t,e){function r(){this.constructor=t}for(var n in e)l.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};u=e("underscore"),p=e("mvc"),o=p.Model,n=p.Collection,i=e("models/mb/album").MBAlbums,a=e("models/mb/youtube"),s=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return c(e,t),e.prototype.url=function(){return"/api/artist/"+this.id},e.prototype.initialize=function(){return this.albums=new i(this),this.videos=new a(null,{mbartist:this})},e.prototype.parse=function(t){return t.albums&&(this.albums.reset(this.albums.parse(t.albums)),delete t.albums),t},e.prototype.getQuery=function(){return this.get("name")},e.prototype.getLibraryTopTracks=function(){return this.videos.map(function(t){return t.toCloudtunesTrack()})},e.prototype.getSimilar=function(){return this.get("similar")},e}(o),r.exports=s}),require.register("models/mb/track",function(t,e,r){var n,i,s,o,a,u,p,l,c={}.hasOwnProperty,h=function(t,e){function r(){this.constructor=t}for(var n in e)c.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};l=e("mvc"),o=l.Model,n=l.Collection,u=e("models/mb/youtube"),a=e("models/track"),p=e("pubsub"),i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return h(e,t),e.prototype.initialize=function(){return this.videos=new u(null,{mbtrack:this})},e.prototype.getQuery=function(){return""+this.get("artist").get("name")+" - "+this.get("title")},e.prototype.toCloudtunesTrack=function(){return new a({number:this.get("number"),title:this.get("title"),album:this.get("album").get("name"),artist:this.get("artist").get("name"),mbid:this.id,album_mbid:this.get("album").id,artist_mbid:this.get("artist").id})},e.prototype.getDragged=function(){var t;return t=new $.Deferred,$.when(this.videos.ensureFetched()).then(function(e){return function(){var r;return r=[],e.videos.length&&r.push(e.videos.first().toCloudtunesTrack()),t.resolve(r)}}(this)),t},e}(o),s=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return h(e,t),e.prototype.model=i,e.prototype.initialize=function(t){this.album=t},e.prototype.url=function(){return"/api/album/"+this.album.id},e.prototype.parse=function(t){var e,r,n;for(r=0,n=t.length;n>r;r++)e=t[r],e.artist=this.album.get("artist"),e.album=this.album;return t},e}(n),r.exports={MBTracks:s}}),require.register("models/mb/youtube",function(t,e,r){var n,i,s,o,a,u,p,l,c,h,d={}.hasOwnProperty,f=function(t,e){function r(){this.constructor=t}for(var n in e)d.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};c=e("underscore"),h=e("mvc"),i=h.Model,n=h.Collection,p=e("utils").escapeRegExp,l=e("pubsub"),s=e("models/track"),a=e("source_ids").YOUTUBE,o=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return f(e,t),e.prototype.toCloudtunesTrack=function(){var t,e,r,n;return n=this.collection,e=n.mbtrack,t=n.mbartist,r=l.user.library.findWhere({source:a,source_id:this.id}),r||(r=e?e.toCloudtunesTrack():new s({artist:t.get("name"),title:this.getCleanTitle(),artist_mbid:t.id})),r.set({source:a,source_id:this.id,video:this}),r},e.prototype.getCleanTitle=function(){var t,e,r,n,i;return t=(null!=(n=this.collection.mbartist)?n.get("name"):void 0)||this.collection.mbtrack.get("artist").get("name"),this._re||(e=p(t.toLowerCase()).replace(/\s+/g,"s+").replace(/(and|&)+/g,"(and|&)"),this._re=new RegExp("^\\s*(the\\s*)?"+e+"[\\s|:/-]+","i")),r=this.get("title").replace(this._re,""),('"'===(i=r[0])||"'"===i||"`"===i)&&r[0]===r[r.length-1]&&(r=r.slice(1,-1)),r||this.get("title")},e}(i),u=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return f(e,t),e.prototype.model=o,e.prototype.initialize=function(t,r){if(this.mbartist=r.mbartist,this.mbtrack=r.mbtrack,!this.mbartist&&!this.mbtrack)throw"MISSING TRACK OR ARTIST";return e.__super__.initialize.call(this,t,r)},e.prototype.url=function(){var t;return t=(this.mbartist||this.mbtrack).getQuery(),t=encodeURIComponent(t),"https://gdata.youtube.com/feeds/api/videos?v=2&alt=jsonc&category=Music&q="+t},e.prototype.fetch=function(t){return t||(t={}),t.dataType="jsonp",e.__super__.fetch.call(this,t)},e.prototype.parse=function(t){return t.data.items},e}(n),r.exports=u}),require.register("models/media/base",function(t,e,r){var n,i,s,o={}.hasOwnProperty,a=function(t,e){function r(){this.constructor=t}for(var n in e)o.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};i=e("mvc").Model,s=function(t){return console.error("NotImplementedError "+t)},n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return a(e,t),e.prototype.defaults={position:0,loaded:0,track:null},e.prototype.play=function(){return s("play")},e.prototype.pause=function(){return s("pause")},e.prototype.paused=function(){return s("paused")},e.prototype.stop=function(){return s("stop")},e.prototype.setVolume=function(){return s("setVolume")},e.prototype.setPosition=function(){return s("setPosition")},e}(i),r.exports=n}),require.register("models/media/sound",function(t,e,r){var n,i,s,o={}.hasOwnProperty,a=function(t,e){function r(){this.constructor=t}for(var n in e)o.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};i=e("models/media/base"),s=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return a(e,t),e.prototype.initialize=function(){return e.__super__.initialize.apply(this,arguments),this.sound=soundManager.createSound({id:"t"+this.id,url:this._getUrl(),onfinish:function(t){return function(){return t.trigger("finish")}}(this),whileplaying:_.throttle(function(t){return function(){return t.sound?t.set("position",t.sound.position/t.sound.durationEstimate*100):void 0}}(this),1e3),whileloading:_.throttle(function(t){return function(){return t.sound?t.set("loaded",t.sound.bytesLoaded/t.sound.bytesTotal*100):void 0}}(this),200)})},e.prototype._getUrl=function(){throw"not implemented"},e.prototype.play=function(){return this.sound.play()},e.prototype.pause=function(){return this.sound.pause()},e.prototype.paused=function(){return this.sound.paused},e.prototype.resume=function(){return this.sound.resume()},e.prototype.stop=function(){return this.sound.stop(),soundManager.destroySound(this.sound.id),delete this.sound},e.prototype.setVolume=function(t){return this.sound.setVolume(t)},e.prototype.setPosition=function(t){return this.sound.setPosition(this.sound.durationEstimate/100*t)},e}(i),n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return a(e,t),e.prototype._getUrl=function(){return"/dropbox/play/"+this.get("track").id},e}(s),r.exports={DropboxTrack:n}}),require.register("models/media/youtube",function(t,e,r){var n,i,s,o,a,u={}.hasOwnProperty,p=function(t,e){function r(){this.constructor=t}for(var n in e)u.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},l=function(t,e){return function(){return t.apply(e,arguments)}};i=e("mvc").Model,n=e("models/media/base"),s=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return p(e,t),e.prototype.initialize=function(){return this.player=a},e.prototype.stop=function(){return this.player.off(null,null,this),this.player.stop()},e.prototype.play=function(){return this.player.on("change:state",function(t){return function(){return t.player.get("state")===t.player.ENDED?t.trigger("finish"):void 0}}(this),this),this.player.on("change:position",function(t){return function(e,r){return t.player=e,t.set("position",r)}}(this),this),this.player.on("change:loaded",function(t){return function(e,r){return t.player=e,t.set("loaded",r)}}(this),this),this.player.play(this.get("track").get("source_id"))},e.prototype.pause=function(){return this.player.pause()},e.prototype.paused=function(){return this.player.paused()},e.prototype.resume=function(){return this.player.resume()},e.prototype.setVolume=function(t){return this.player.setVolume(t)},e.prototype.setPosition=function(t){return this.player.setPosition(t)},e}(n),o=function(t){function e(){return this.handleError=l(this.handleError,this),this.reportProgress=l(this.reportProgress,this),this.handleStateChanged=l(this.handleStateChanged,this),this.playerReady=l(this.playerReady,this),e.__super__.constructor.apply(this,arguments)}return p(e,t),e.prototype.id="youtube-player",e.prototype.UNSTARTED=-1,e.prototype.ENDED=0,e.prototype.PLAYING=1,e.prototype.PAUSED=2,e.prototype.BUFFERING=3,e.prototype.VIDEO_CUED=5,e.prototype.INITIALIZING=11,e.prototype.READY=12,e.prototype.ERROR=13,e.prototype.defaults={state:e.prototype.INITIALIZING,error:"",position:0,loaded:0},e.prototype.initialize=function(){var t;return $("<div id='"+this.id+"'></div>").appendTo($("#medium")),window.youtubePlayer=this,window.onYouTubePlayerReady=this.playerReady,t={url:"http://www.youtube.com/apiplayer?enablejsapi=1&version=3",id:this.id,width:"150",height:"150",version:"8",xiUrl:null,flashVars:null,params:{allowScriptAccess:"always"},attributes:null,callback:this.swfReady},swfobject.embedSWF(t.url,t.id,t.width,t.height,t.version,t.xiUrl,t.flashVars,t.params,t.attributes,t.callback)},e.prototype.player=function(){},e.prototype.swfReady=function(t){return t.success?t.ref.style.visibility="hidden":void alert("YouTube player failed to load")},e.prototype.playerReady=function(){var t;return t=document.getElementById(this.id),this.set({state:this.READY}),t.addEventListener("onStateChange","youtubePlayer.handleStateChanged"),t.addEventListener("onError","youtubePlayer.handleError"),this.player=function(){return t},this.autoplay&&this.play(),this.autovolume?this.setVolume(this.autovolume):void 0},e.prototype.handleStateChanged=function(t){return window.clearInterval(this.timer),(t===this.BUFFERING||t===this.PLAYING)&&(this.timer=window.setInterval(this.reportProgress,1e3)),this.set("state",t)},e.prototype.reportProgress=function(){return this.set({position:this.player().getCurrentTime()/this.player().getDuration()*100,loaded:100*this.player().getVideoLoadedFraction()})},e.prototype.handleError=function(t){var e;return e=function(){switch(t){case 2:return"request contains an invalid parameter";case 100:return"the video requested was not found";
case 101:case 150:return"the video requested does not allow playback in the embedded players";default:return"unknown error"}}(),this.set({state:this.ERROR,error:e})},e.prototype.stop=function(){return this.player().style.visibility="hidden",this.player().stopVideo()},e.prototype.play=function(t){return console.log("playing ",t),this.player().style.visibility="visible",this.player()?this.player().loadVideoById(t):this.autoplay=!0},e.prototype.pause=function(){return this.player().pauseVideo()},e.prototype.paused=function(){return this.player().getPlayerState()===this.PAUSED},e.prototype.resume=function(){return this.player().playVideo()},e.prototype.setVolume=function(t){return this.player()?this.player().setVolume(t):this.autovolume=t},e.prototype.setPosition=function(t){var e;if(this.player())return e=this.player().getDuration(),0===e?0:this.player().seekTo(e/100*t,!0)},e}(i),a=new o,r.exports=s}),require.register("models/player",function(t,e,r){var n,i,s,o,a,u,p,l,c,h,d,f,y,m,g,_,v=function(t,e){return function(){return t.apply(e,arguments)}},b={}.hasOwnProperty,w=function(t,e){function r(){this.constructor=t}for(var n in e)b.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};m=e("mvc"),o=m.Model,n=m.Collection,y=e("pubsub"),g=e("source_ids"),i=g.DROPBOX,h=g.YOUTUBE,s=e("models/media/sound").DropboxTrack,d=e("models/media/youtube"),p=e("models/lists/play_queue"),_=["playing","paused","stopped"],u=_[0],a=_[1],c=_[2],f=function(t){switch(t.get("source")){case i:return new s({track:t});case h:return new d({track:t});default:throw"Unknown source"}},l=function(t){function e(){return this.prev=v(this.prev,this),this.next=v(this.next,this),this.resume=v(this.resume,this),this.pause=v(this.pause,this),this.toggle=v(this.toggle,this),this.stop=v(this.stop,this),this.position=v(this.position,this),this.volume=v(this.volume,this),e.__super__.constructor.apply(this,arguments)}return w(e,t),e.prototype.defaults={repeat:!1,random:!1,state:c,track:null,volume:50,position:0,duration:0,loaded:0,playlist:null},e.prototype.initialize=function(t,r){return e.__super__.initialize.call(this,t,r),this.queue=new p},e.prototype.state=function(t){return null==t&&(t=null),t?this.set("state",t):this.get("state")},e.prototype.playing=function(t){return this.state(null!=t?u:null)===u},e.prototype.paused=function(t){return this.state(null!=t?a:null)===a},e.prototype.stopped=function(t){return this.state(null!=t?c:null)===c},e.prototype.volume=function(t){var e;return null!=t?(this.set("volume",t),null!=(e=this.medium)?e.setVolume(t):void 0):this.get("volume")},e.prototype.position=function(t,e){var r;return null==t?this.get("position"):(this.set("position",t),e?void 0:null!=(r=this.medium)?r.setPosition(t):void 0)},e.prototype.play=function(t){return null==t&&(t=null),this.stop(),t?this.queue.setCurrent(t):t=this.queue.getCurrent(),this.medium=f(t),this.medium.on("finish",this.next,this),this.medium.on("change:position",function(t){return function(e,r){return e===t.medium?t.position(r,!0):void 0}}(this),this),this.medium.on("change:loaded",function(t){return function(e,r){return e===t.medium?t.set("loaded",r):void 0}}(this),this),this.medium.setVolume(this.volume()),this.set({track:t,state:u,position:0,loaded:0}),this.medium.play()},e.prototype.stop=function(){return this.stopped(!0),this.medium?(this.medium.off(null,null,this),this.medium.stop(),delete this.medium):void 0},e.prototype.toggle=function(){var t;return this.medium?this.medium.paused()?this.resume():this.pause():(t=this.queue.getCurrent(),this.play(t))},e.prototype.pause=function(){return this.medium.pause(),this.paused(!0)},e.prototype.resume=function(){return this.playing(!0),this.medium.resume()},e.prototype.next=function(){return this.queue.hasNext()?this.play(this.queue.next()):this.get("repeat")?(this.queue.rewind(),this.play()):(this.stop(),this.queue.rewind())},e.prototype.prev=function(){var t;return t=this.queue.prev(),t?this.play(t):(this.stop(),this.queue.rewind())},e.prototype.replaceQueue=function(t){return this.stop(),this.queue.replace(t)},e}(o),r.exports=l}),require.register("models/sidebar",function(t,e,r){var n,i,s,o={}.hasOwnProperty,a=function(t,e){function r(){this.constructor=t}for(var n in e)o.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};s=e("underscore"),n=e("mvc").Model,i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return a(e,t),e.prototype.defaults={width:180},e}(n),r.exports=i}),require.register("models/track",function(t,e,r){var n,i,s={}.hasOwnProperty,o=function(t,e){function r(){this.constructor=t}for(var n in e)s.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};n=e("mvc").Model,i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return o(e,t),e.prototype.defaults={artist:"Unknown Artist",album:"Unknown Album",title:"Untitled Track"},e.prototype.url=function(){var t;return t=""+this.collection.url+"/tracks",this.id&&(t+="/"+this.id),t},e.prototype.equals=function(t){return this===t?!0:this.has("mbid")&&t.has("mbid")?this.get("mbid")===t.get("mbid"):void 0},e}(n),r.exports=i}),require.register("models/user",function(t,e,r){var n,i,s,o={}.hasOwnProperty,a=function(t,e){function r(){this.constructor=t}for(var n in e)o.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};s=e("underscore"),n=e("mvc").Model,i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return a(e,t),e.prototype.url="/api/user",e.prototype.isNew=function(){return!1},e.prototype.initialize=function(){},e.prototype.serverChange=function(t){return t=JSON.parse(t),this.set(t)},e.prototype.toJSON=function(){return s.pick(this.attributes,"email","name","picture","username","desktop_notifications","confirm_exit","location")},e}(n),r.exports=i}),require.register("models/user_library",function(t,e,r){var n,i,s,o,a,u,p,l,c,h,d,f,y,m,g={}.hasOwnProperty,v=function(t,e){function r(){this.constructor=t}for(var n in e)g.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};i=e("backbone"),s=e("mvc").Collection,y=e("models/lists/playlists"),a=y.Playlist,u=y.Playlists,l=y.TrackList,n=y.AllPlaylist,l=e("models/lists/tracklist"),p=e("models/track"),m=e("source_ids"),o=m.DROPBOX,h=m.YOUTUBE,f=function(t,e){var r,n,i,s,o,a,u,p;a=[];for(s in t){i=t[s];for(r in i)for(n=i[r],u=0,p=n.length;p>u;u++)o=n[u],a.push(d(s,r,o,e))}return a},d=function(t,e,r,n){var i,s,o,a,u;for(s=0,o={artist:t,album:e},s=a=0,u=n.length;u>a;s=++a)i=n[s],o[i]=r[s];return o},c=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return v(e,t),e.prototype.model=p,e.prototype.url="/api/library",e.prototype.initialize=function(t,r){return e.__super__.initialize.call(this,t,r),this.tracklist=new l({parent:this}),this.playlists=new u([new n({parent:this,name:"All",id:"all"}),new a({parent:this,name:"Dropbox",icon:"dropbox",id:"dropbox",criteria:new l.prototype.Criteria({source:o})}),new a({parent:this,name:"YouTube",icon:"youtube",id:"youtube",criteria:new l.prototype.Criteria({source:h})})])},e.prototype.parse=function(t){return this.playlists.add(t.playlists),f(t.collection,t._fields)},e.prototype.getTracks=function(){return this.models},e.prototype.ensureIncluded=function(t){var e,r,n,i;return e=new $.Deferred,r=_.where(t,{id:void 0}),r.length?(this.add(r),n=function(){var t,e,n;for(n=[],t=0,e=r.length;e>t;t++)i=r[t],n.push(i.save());return n}(),$.when.apply(null,n).then(e.resolve),e.promise()):e.resolve()},e}(s),r.exports=c}),require.register("models/youtube/track",function(t,e){var r,n,i={}.hasOwnProperty,s=function(t,e){function r(){this.constructor=t}for(var n in e)i.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};r=e("models/track"),n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),e.prototype.getImages=function(){return["http://i.ytimg.com/vi/"+this.getSourceID()+"/default.jpg"]},e}(r)}),require.register("mvc",function(t,e,r){var n,i,s,o,a,u,p,l={}.hasOwnProperty,c=function(t,e){function r(){this.constructor=t}for(var n in e)l.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},h=function(t,e){return function(){return t.apply(e,arguments)}},d=[].slice;p=e("underscore"),n=e("backbone"),o=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return c(e,t),e.prototype.fetch=function(t){return this._deferred=e.__super__.fetch.call(this,t)},e.prototype.ensureFetched=function(t){return this._deferred?void 0:this.fetch(t)},e.prototype.toString=function(){return"["+this.constructor.name+" '"+(this.get("name")||this.get("title"))+"]'"},e}(n.Model),i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return c(e,t),e.prototype.fetch=function(t){return this._deferred=e.__super__.fetch.call(this,t)},e.prototype.ensureFetched=function(t){return this._deferred?void 0:this.fetch(t)},e}(n.Collection),s=function(){function t(){}return t}(),u=function(t){function e(){var t;t=1<=arguments.length?d.call(arguments,0):[],this.render=h(this.render,this),this.remove=h(this.remove,this),this._forgetSubview=h(this._forgetSubview,this),this.subview=h(this.subview,this),this.subviews=[],this.subviewsByName={},e.__super__.constructor.apply(this,t)}return c(e,t),e.prototype.subviews=null,e.prototype.subviewsByName=null,e.prototype.container=null,e.prototype.template=null,e.prototype.subview=function(t,r){if(!r){if(!(t instanceof e))return this.subviewsByName[t];r=t,t=r.cid}return r.once("remove",this._forgetSubview),this.subviews.push(r),this.subviewsByName[t]=r,r},e.prototype._forgetSubview=function(t){return this.subviews=p.without(this.subviews,t),delete this.subviewsByName[name]},e.prototype.remove=function(){return this.trigger("remove",this),e.__super__.remove.call(this),this.off(),this.removeSubviews()},e.prototype.removeSubviews=function(){var t,e,r,n;for(n=this.subviews,e=0,r=n.length;r>e;e++)t=n[e],t.remove();return this.subviews.length=0},e.prototype.getTemplate=function(){return this.template},e.prototype.getTemplateData=function(){return this.model?this.model.toJSON():void 0},e.prototype.render=function(){var t;return t=this.getTemplate(),t&&this.$el.html(t(this.getTemplateData())),this.container&&$(this.container).append(this.el),this},e}(n.View),a=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return c(e,t),e.prototype.container="#page",e}(u),r.exports={Model:o,View:u,PageView:a,Collection:i,Controller:s}}),require.register("notifications",function(t,e,r){r.exports=function(t){var e,r,n,i,s;return r=t.image,s=t.title,e=t.body,(n=window.webkitNotifications)?(i=function(){var t;return t=n.createNotification(r,s,e),t.onclick=function(){return window.blur(),window.focus()},t.show()},0===n.checkPermission()?i():n.requestPermission(function(){return 0===n.checkPermission()?i():void 0})):void 0}}),require.register("pubsub",function(t,e,r){var n,i,s;n=e("backbone"),s=e("underscore"),i=s.extend({},n.Events),i.subscribe=i.on,i.unsubscribe=i.off,i.publish=i.trigger,r.exports=i}),require.register("router",function(t,e,r){var n,i,s,o,a,u,p,l,c,h={}.hasOwnProperty,d=function(t,e){function r(){this.constructor=t}for(var n in e)h.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};i=e("backbone"),c=e("pubsub"),a=e("views/playlists/playlist_page_view"),l=e("views/settings/settings_page_view"),n=e("views/artist/artist_page_view"),s=e("views/explore/explore_page_view"),p=e("views/search/search_page_view"),o=e("models/mb/artist"),u=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return d(e,t),e.prototype.routes={collection:"library",queue:"queue","playlist/:playlist":"library","settings/:section":"settings",settings:"settings","artist/:id/:section":"artist","artist/:id":"artist",search:"search","":"explore",":section":"explore"},e.prototype.explore=function(t){var e;return null!=(e=this.view)&&e.remove(),this.view=new s({section:t,model:c.user}).render()},e.prototype.search=function(){var t;return null!=(t=this.view)&&t.remove(),this.view=(new p).render()},e.prototype.queue=function(){return this.library("queue")},e.prototype.library=function(t){var e,r,n;return null==t&&(t="all"),null!=(n=this.view)&&n.remove(),r=c.user.library.playlists,e=r.get(t),e&&r.selected(e),this.view=new a({model:c.libraryState}),this.view.render()},e.prototype.settings=function(t){var e;return null!=(e=this.view)&&e.remove(),this.view=new l({model:c.user,section:t}),this.view.render()},e.prototype.artist=function(t,e){var r;return null!=(r=this.view)&&r.remove(),this.view=new n({model:new o({id:t}),section:e}),this.view.render()},e}(i.Router),r.exports=u}),require.register("source_ids",function(t,e,r){r.exports={DROPBOX:"d",YOUTUBE:"y"}}),require.register("templates/artist/album",function(t,e,r){var n=Handlebars.template(function(t,e,r,n,i){function s(t,e){var n,i,s="";return s+='\n                <span class="type">',(i=r.subtypes)?n=i.call(t,{hash:{},data:e}):(i=t&&t.subtypes,n=typeof i===p?i.call(t,{hash:{},data:e}):i),s+=l(n)+"</span>\n            "}this.compilerInfo=[4,">= 1.0.0"],r=this.merge(r,t.helpers),i=i||{};var o,a,u="",p="function",l=this.escapeExpression,c=this;return u+='<h3 draggable="true">\n    <span class="name" title="Show tracks">\n        <img src="'+l((o=e&&e.images,o=null==o||o===!1?o:o.medium,typeof o===p?o.apply(e):o))+'" />\n        ',(a=r.name)?o=a.call(e,{hash:{},data:i}):(a=e&&e.name,o=typeof a===p?a.call(e,{hash:{},data:i}):a),u+=l(o)+'\n        <span class="meta">\n            ',o=r["if"].call(e,e&&e.subtypes,{hash:{},inverse:c.noop,fn:c.program(1,s,i),data:i}),(o||0===o)&&(u+=o),u+='\n        </span>\n    </span>\n</h3>\n<div class="body">\n\n    <div class="buttons">\n        <span class="button play-all toggle icon-play" title="Play album">Play Album</span>\n        <!--<span class="button add-all toggle icon-plus" title="Add album to collection"></span>-->\n    </div>\n\n    <div class="tracklist">\n\n    </div>\n\n</div>\n'});"function"==typeof define&&define.amd?define([],function(){return n}):"object"==typeof r&&r&&r.exports&&(r.exports=n)}),require.register("templates/artist/artist_list",function(t,e,r){var n=Handlebars.template(function(t,e,r,n,i){function s(t,e){var n,i,s="";return s+='\n        <li>\n            <a href="/artist/',(i=r.id)?n=i.call(t,{hash:{},data:e}):(i=t&&t.id,n=typeof i===u?i.call(t,{hash:{},data:e}):i),s+=p(n)+'" style="background-image: url(\''+p((n=t&&t.images,n=null==n||n===!1?n:n.extralarge,typeof n===u?n.apply(t):n))+'\')">\n                <span class="name"><span>',(i=r.name)?n=i.call(t,{hash:{},data:e}):(i=t&&t.name,n=typeof i===u?i.call(t,{hash:{},data:e}):i),s+=p(n)+"</span></span>\n            </a>\n        </li>\n    "}this.compilerInfo=[4,">= 1.0.0"],r=this.merge(r,t.helpers),i=i||{};var o,a="",u="function",p=this.escapeExpression,l=this;return a+='<ul class="artist-list">\n    ',o=r.each.call(e,e&&e.artists,{hash:{},inverse:l.noop,fn:l.program(1,s,i),data:i}),(o||0===o)&&(a+=o),a+="\n</ul>\n"});"function"==typeof define&&define.amd?define([],function(){return n}):"object"==typeof r&&r&&r.exports&&(r.exports=n)}),require.register("templates/artist/track",function(t,e,r){var n=Handlebars.template(function(t,e,r,n,i){this.compilerInfo=[4,">= 1.0.0"],r=this.merge(r,t.helpers),i=i||{};var s,o,a="",u="function",p=this.escapeExpression;return a+='<h4 title="Show track versions" draggable="true"><span>',(o=r.number)?s=o.call(e,{hash:{},data:i}):(o=e&&e.number,s=typeof o===u?o.call(e,{hash:{},data:i}):o),a+=p(s)+".</span> ",(o=r.title)?s=o.call(e,{hash:{},data:i}):(o=e&&e.title,s=typeof o===u?o.call(e,{hash:{},data:i}):o),a+=p(s)+'</h4>\n<div class="videos-wrap">\n    <div class="videos"></div>\n</div>\n'});"function"==typeof define&&define.amd?define([],function(){return n}):"object"==typeof r&&r&&r.exports&&(r.exports=n)}),require.register("templates/artist/tracklist",function(t,e,r){var n=Handlebars.template(function(t,e,r,n,i){return this.compilerInfo=[4,">= 1.0.0"],r=this.merge(r,t.helpers),i=i||{},'<!-- FIXME: duplicated in ./playlist_browse.hbs -->\n<div class="list tracks">\n    <div class="head-wrap">\n        <table class="head">\n            <tr>\n                <td></td>\n                <td>Name</td>\n            </tr>\n        </table>\n    </div>\n    <div class="body playable-list">\n\n    </div>\n</div>\n'});"function"==typeof define&&define.amd?define([],function(){return n}):"object"==typeof r&&r&&r.exports&&(r.exports=n)}),require.register("templates/artist/video",function(t,e,r){var n=Handlebars.template(function(t,e,r,n,i){this.compilerInfo=[4,">= 1.0.0"],r=this.merge(r,t.helpers),i=i||{};var s,o,a="",u="function",p=this.escapeExpression;return a+='<img src="'+p((s=e&&e.thumbnail,s=null==s||s===!1?s:s.hqDefault,typeof s===u?s.apply(e):s))+'" />\n<span class="title">',(o=r.title)?s=o.call(e,{hash:{},data:i}):(o=e&&e.title,s=typeof o===u?o.call(e,{hash:{},data:i}):o),a+=p(s)+"</span>\n"});"function"==typeof define&&define.amd?define([],function(){return n}):"object"==typeof r&&r&&r.exports&&(r.exports=n)}),require.register("templates/layout",function(t,e,r){var n=Handlebars.template(function(t,e,r,n,i){return this.compilerInfo=[4,">= 1.0.0"],r=this.merge(r,t.helpers),i=i||{},'<div id="main">\n\n    <div id="nav-sidebar" class="sidebar">\n\n\n        <section class="explore">\n            <h2><a href="/">Cloudtunes</a></h2>\n\n            <ul></ul>\n\n        </section>\n\n        <section class="collection">\n            <h2>Collection</h2>\n\n            <ul class="builtin-playlists">\n            </ul>\n        </section>\n\n        <section class="playlists">\n            <h2>Playlists</h2>\n\n            <ul class="user-playlists"></ul>\n\n            <div class="tools">\n                <div class="button add create-playlist">\n                    <i class="icon-plus-sign"></i>\n                    New Playlist\n                </div>\n            </div>\n\n        </section>\n\n        <section class="user">\n\n            <div class="profile"></div>\n\n            <div class="settings">\n                <a href="/settings">\n                    <i class="icon-cog"></i>\n                </a>\n            </div>\n        </section>\n\n\n    </div>\n    <div class="resize-col resize-nav-sidebar"></div>\n\n    <div id="page"></div>\n\n\n    <div id="info-sidebar" class="sidebar">\n\n        <div id="medium"></div>\n        <div id="player"></div>\n\n    </div>\n    <div class="resize-col resize-info-sidebar"></div>\n\n</div>\n\n<div id="menu">\n    <div class="pointer"></div>\n</div>\n'});"function"==typeof define&&define.amd?define([],function(){return n}):"object"==typeof r&&r&&r.exports&&(r.exports=n)}),require.register("templates/page",function(t,e,r){var n=Handlebars.template(function(t,e,r,n,i){function s(t,e){var n,i,s="";return s+='\n            <a href="',(i=r.url)?n=i.call(t,{hash:{},data:e}):(i=t&&t.url,n=typeof i===p?i.call(t,{hash:{},data:e}):i),s+=l(n)+'" class="',(i=r.className)?n=i.call(t,{hash:{},data:e}):(i=t&&t.className,n=typeof i===p?i.call(t,{hash:{},data:e}):i),s+=l(n)+'">',(i=r.name)?n=i.call(t,{hash:{},data:e}):(i=t&&t.name,n=typeof i===p?i.call(t,{hash:{},data:e}):i),s+=l(n)+"</a>\n        "}this.compilerInfo=[4,">= 1.0.0"],r=this.merge(r,t.helpers),i=i||{};var o,a,u="",p="function",l=this.escapeExpression,c=this;return u+="<header>\n    <h2>",(a=r.pageName)?o=a.call(e,{hash:{},data:i}):(a=e&&e.pageName,o=typeof a===p?a.call(e,{hash:{},data:i}):a),u+=l(o)+"</h2>\n    <nav>\n        ",o=r.each.call(e,e&&e.sections,{hash:{},inverse:c.noop,fn:c.program(1,s,i),data:i}),(o||0===o)&&(u+=o),u+='\n    </nav>\n</header>\n\n<div class="content"></div>\n'});"function"==typeof define&&define.amd?define([],function(){return n}):"object"==typeof r&&r&&r.exports&&(r.exports=n)}),require.register("templates/player",function(t,e,r){var n=Handlebars.template(function(t,e,r,n,i){return this.compilerInfo=[4,">= 1.0.0"],r=this.merge(r,t.helpers),i=i||{},'\n<div class="slider position">\n    <div class="loaded"></div>\n    <div class="elapsed"></div>\n    <div class="pos"></div>\n</div>\n\n<div class="buttons">\n\n    <div class="playback">\n        <div class="button prev icon-backward"></div>\n        <div class="button toggle icon-play"></div>\n        <div class="button next icon-forward"></div>\n    </div>\n\n    <div class="settings">\n\n        <div class="button repeat icon-repeat"></div>\n\n        <div class="volume-widget closed">\n\n            <div class="button icon-volume-up volume-icon"></div>\n\n            <div class="volume-popup">\n\n                <div class="slider volume">\n                    <div class="elapsed"></div>\n                    <div class="pos"></div>\n                </div>\n\n                <div class="button icon-volume-up volume-icon"></div>\n\n            </div>\n\n        </div>\n    </div>\n\n</div>\n\n\n\n\n<div class="track"></div>\n'});"function"==typeof define&&define.amd?define([],function(){return n}):"object"==typeof r&&r&&r.exports&&(r.exports=n)}),require.register("templates/player_track",function(t,e,r){var n=Handlebars.template(function(t,e,r,n,i){function s(){return"—"}this.compilerInfo=[4,">= 1.0.0"],r=this.merge(r,t.helpers),i=i||{};var o,a="",u="function",p=this.escapeExpression,l=this;return a+='<span class="title">'+p((o=e&&e.track,o=null==o||o===!1?o:o.title,typeof o===u?o.apply(e):o))+'</span>\n<span class="artist">'+p((o=e&&e.track,o=null==o||o===!1?o:o.artist,typeof o===u?o.apply(e):o))+"</span>\n\n",o=r["if"].call(e,(o=e&&e.track,null==o||o===!1?o:o.album),{hash:{},inverse:l.noop,fn:l.program(1,s,i),data:i}),(o||0===o)&&(a+=o),a+='\n<span class="album">'+p((o=e&&e.track,o=null==o||o===!1?o:o.album,typeof o===u?o.apply(e):o))+"</span>\n"});"function"==typeof define&&define.amd?define([],function(){return n}):"object"==typeof r&&r&&r.exports&&(r.exports=n)}),require.register("templates/playlists/playlist_browse",function(t,e,r){var n=Handlebars.template(function(t,e,r,n,i){return this.compilerInfo=[4,">= 1.0.0"],r=this.merge(r,t.helpers),i=i||{},'<div class="resize-row resize-main-grid"></div>\n<div class="resize-col resize-main-grid"></div>\n\n<div class="list artists">\n    <h2>Artists</h2>\n    <div class="body playable-list">\n\n    </div>\n</div>\n\n<div class="list albums">\n    <h2>Albums</h2>\n    <div class="body playable-list">\n\n    </div>\n</div>\n\n\n<!--FIXME: duplicated in ./track_list.hbs-->\n<div class="list tracks">\n    <div class="head-wrap">\n        <table class="head">\n            <tr>\n                <td data-order-field="number"></td>\n                <td data-order-field="title">Track</td>\n                <td data-order-field="artist">Artist</td>\n                <td data-order-field="album">Album</td>\n            </tr>\n        </table>\n    </div>\n    <div class="body playable-list">\n\n    </div>\n</div>\n'});"function"==typeof define&&define.amd?define([],function(){return n}):"object"==typeof r&&r&&r.exports&&(r.exports=n)}),require.register("templates/playlists/playlist_header",function(t,e,r){var n=Handlebars.template(function(t,e,r,n,i){function s(){return'\n<span class="icon-cog options"></span>\n'}this.compilerInfo=[4,">= 1.0.0"],r=this.merge(r,t.helpers),i=i||{};var o,a,u="",p="function",l=this.escapeExpression,c=this;return u+='<h2><i class="icon-',(a=r.icon)?o=a.call(e,{hash:{},data:i}):(a=e&&e.icon,o=typeof a===p?a.call(e,{hash:{},data:i}):a),u+=l(o)+'" /> ',(a=r.name)?o=a.call(e,{hash:{},data:i}):(a=e&&e.name,o=typeof a===p?a.call(e,{hash:{},data:i}):a),u+=l(o)+"</h2>\n\n",o=r["if"].call(e,e&&e.showOptions,{hash:{},inverse:c.noop,fn:c.program(1,s,i),data:i}),(o||0===o)&&(u+=o),u+="\n"});"function"==typeof define&&define.amd?define([],function(){return n}):"object"==typeof r&&r&&r.exports&&(r.exports=n)}),require.register("templates/playlists/tracklist",function(t,e,r){var n=Handlebars.template(function(t,e,r,n,i){return this.compilerInfo=[4,">= 1.0.0"],r=this.merge(r,t.helpers),i=i||{},'<!-- FIXME: duplicated in ./playlist_browse.hbs -->\n<div class="list tracks">\n    <div class="head-wrap">\n        <table class="head">\n            <tr>\n                <td data-order-field="number">#</td>\n                <td data-order-field="title">Name</td>\n                <td data-order-field="artist">Artist</td>\n                <td data-order-field="album">Album</td>\n            </tr>\n        </table>\n    </div>\n    <div class="body playable-list">\n\n    </div>\n</div>\n'});"function"==typeof define&&define.amd?define([],function(){return n}):"object"==typeof r&&r&&r.exports&&(r.exports=n)}),require.register("templates/search/search_page",function(t,e,r){var n=Handlebars.template(function(t,e,r,n,i){return this.compilerInfo=[4,">= 1.0.0"],r=this.merge(r,t.helpers),i=i||{},'<div id="search">\n    <input type="text" autofocus id="q" placeholder="Search in your collection and elsewhere" autocomplete="off"/>\n    <div class="suggest"></div>\n</div>\n'});"function"==typeof define&&define.amd?define([],function(){return n}):"object"==typeof r&&r&&r.exports&&(r.exports=n)}),require.register("templates/search/search_suggest",function(t,e,r){var n=Handlebars.template(function(t,e,r,n,i){function s(t,e){var n,i,s="";return s+='\n        <section class="',(i=r.id)?n=i.call(t,{hash:{},data:e}):(i=t&&t.id,n=typeof i===c?i.call(t,{hash:{},data:e}):i),s+=h(n)+'">\n\n            <h2>',(i=r.name)?n=i.call(t,{hash:{},data:e}):(i=t&&t.name,n=typeof i===c?i.call(t,{hash:{},data:e}):i),s+=h(n)+"</h2>\n\n            <ul>\n                ",n=r.each.call(t,t&&t.items,{hash:{},inverse:d.noop,fn:d.programWithDepth(2,o,e,t),data:e}),(n||0===n)&&(s+=n),s+="\n            </ul>\n\n        </section>\n    "}function o(t,e,n){var i,s,o="";return o+='\n                    <li data-item="',(s=r.id)?i=s.call(t,{hash:{},data:e}):(s=t&&t.id,i=typeof s===c?s.call(t,{hash:{},data:e}):s),o+=h(i)+'" data-type="'+h((i=n&&n.type,typeof i===c?i.apply(t):i))+'" class="item">\n                        ',(s=r.text)?i=s.call(t,{hash:{},data:e}):(s=t&&t.text,i=typeof s===c?s.call(t,{hash:{},data:e}):s),(i||0===i)&&(o+=i),o+="\n                        ",i=r["if"].call(t,t&&t.note,{hash:{},inverse:d.noop,fn:d.program(3,a,e),data:e}),(i||0===i)&&(o+=i),o+="\n                    </li>\n                "}function a(t,e){var n,i,s="";return s+='\n                            <div class="note">',(i=r.note)?n=i.call(t,{hash:{},data:e}):(i=t&&t.note,n=typeof i===c?i.call(t,{hash:{},data:e}):i),s+=h(n)+"</div>\n                        "}this.compilerInfo=[4,">= 1.0.0"],r=this.merge(r,t.helpers),i=i||{};var u,p,l="",c="function",h=this.escapeExpression,d=this;return l+='<section class="',(p=r.id)?u=p.call(e,{hash:{},data:i}):(p=e&&e.id,u=typeof p===c?p.call(e,{hash:{},data:i}):p),l+=h(u)+'">\n\n    <h1>',(p=r.name)?u=p.call(e,{hash:{},data:i}):(p=e&&e.name,u=typeof p===c?p.call(e,{hash:{},data:i}):p),l+=h(u)+"</h1>\n\n    ",u=r.each.call(e,e&&e.sections,{hash:{},inverse:d.noop,fn:d.program(1,s,i),data:i}),(u||0===u)&&(l+=u),l+='\n\n    <ul>\n        <li class="item show-all">',(p=r.showAllLabel)?u=p.call(e,{hash:{},data:i}):(p=e&&e.showAllLabel,u=typeof p===c?p.call(e,{hash:{},data:i}):p),l+=h(u)+"</li>\n    </ul>\n\n</section>\n"});"function"==typeof define&&define.amd?define([],function(){return n}):"object"==typeof r&&r&&r.exports&&(r.exports=n)}),require.register("templates/settings/notifications",function(t,e,r){var n=Handlebars.template(function(t,e,r,n,i){function s(){return"checked"}this.compilerInfo=[4,">= 1.0.0"],r=this.merge(r,t.helpers),i=i||{};var o,a="",u=this;return a+='<form action="">\n\n    <p>\n        <label>\n            <input type="checkbox" value="1" name="desktop_notifications" ',o=r["if"].call(e,e&&e.desktop_notifications,{hash:{},inverse:u.noop,fn:u.program(1,s,i),data:i}),(o||0===o)&&(a+=o),a+=' />\n            Enable desktop notifications\n        </label>\n    </p>\n    <p>\n        <label>\n            <input type="checkbox" value="1" name="confirm_exit" ',o=r["if"].call(e,e&&e.confirm_exit,{hash:{},inverse:u.noop,fn:u.program(1,s,i),data:i}),(o||0===o)&&(a+=o),a+=" />\n            Confirm exit while music is still playing\n        </label>\n    </p>\n\n</form>\n"});"function"==typeof define&&define.amd?define([],function(){return n}):"object"==typeof r&&r&&r.exports&&(r.exports=n)}),require.register("templates/settings/profile",function(t,e,r){var n=Handlebars.template(function(t,e,r,n,i){function s(t,e){var n,i="";return i+='\n            <img src="'+c((n=t&&t.picture,typeof n===l?n.apply(t):n))+'" class="',n=r["if"].call(t,t&&t.selected,{hash:{},inverse:h.noop,fn:h.program(2,o,e),data:e}),(n||0===n)&&(i+=n),i+='" />\n        '}function o(){return"selected"}this.compilerInfo=[4,">= 1.0.0"],r=this.merge(r,t.helpers),i=i||{};var a,u,p="",l="function",c=this.escapeExpression,h=this;return p+='<form action="">\n    <p>\n        <a class="button external icon-off" href="/logout">Log out</a>\n    </p>\n    <p class="picture">\n        <span class="label">Picture</span>\n        ',a=r.each.call(e,e&&e.services,{hash:{},inverse:h.noop,fn:h.program(1,s,i),data:i}),(a||0===a)&&(p+=a),p+='\n    </p>\n    <p>\n        <label for="acc-name">Name</label>\n        <input name="name" value="',(u=r.name)?a=u.call(e,{hash:{},data:i}):(u=e&&e.name,a=typeof u===l?u.call(e,{hash:{},data:i}):u),p+=c(a)+'" id="acc-name"/>\n    </p>\n    <p>\n        <label for="acc-em">Email</label>\n        <input type="email" name="email" value="',(u=r.email)?a=u.call(e,{hash:{},data:i}):(u=e&&e.email,a=typeof u===l?u.call(e,{hash:{},data:i}):u),p+=c(a)+'" id="acc-em"/>\n    </p>\n    <p>\n        <label for="_username">Username</label>\n        <input name="username" value="',(u=r.username)?a=u.call(e,{hash:{},data:i}):(u=e&&e.username,a=typeof u===l?u.call(e,{hash:{},data:i}):u),p+=c(a)+'" id="_username"/>\n    </p>\n\n    <p>\n        <label for="_location">Location</label>\n        <input name="location" value="',(u=r.location)?a=u.call(e,{hash:{},data:i}):(u=e&&e.location,a=typeof u===l?u.call(e,{hash:{},data:i}):u),p+=c(a)+'" id="_location"/>\n    </p>\n\n    <p class="submit">\n        <button>Save</button>\n    </p>\n\n</form>\n'});"function"==typeof define&&define.amd?define([],function(){return n}):"object"==typeof r&&r&&r.exports&&(r.exports=n)}),require.register("templates/settings/social",function(t,e,r){var n=Handlebars.template(function(t,e,r,n,i){function s(t){var e,r="";return r+='\n                Connected as <span class="username">'+f((e=t&&t.dropbox,e=null==e||e===!1?e:e.username,typeof e===d?e.apply(t):e))+'</span>\n                <a href="/auth/dropbox" target="_blank" class="remove">Remove</a>\n            '}function o(){return'\n                <a href="/auth/dropbox?popup=1" target="_blank" class="connect">Connect</a>\n            '}function a(t){var e,r="";return r+='\n                Connected as\n                <a href="'+f((e=t&&t.facebook,e=null==e||e===!1?e:e.url,typeof e===d?e.apply(t):e))+'" target="_blank" class="username">\n                    <img src="'+f((e=t&&t.facebook,e=null==e||e===!1?e:e.picture,typeof e===d?e.apply(t):e))+'" />\n                    '+f((e=t&&t.facebook,e=null==e||e===!1?e:e.username,typeof e===d?e.apply(t):e))+'\n                </a>\n                <a href="/auth/facebook" target="_blank" class="remove">Remove</a>\n            '}function u(){return'\n                <a href="/auth/facebook?popup=1" target="_blank" class="connect">Connect</a>\n            '}function p(t){var e,r="";return r+='\n            Connected as\n                <a href="'+f((e=t&&t.lastfm,e=null==e||e===!1?e:e.url,typeof e===d?e.apply(t):e))+'" target="_blank" class="username">\n                    <img src="'+f((e=t&&t.lastfm,e=null==e||e===!1?e:e.picture,typeof e===d?e.apply(t):e))+'" />\n                    '+f((e=t&&t.lastfm,e=null==e||e===!1?e:e.username,typeof e===d?e.apply(t):e))+'\n                </a>\n                <a href="/auth/lastfm" target="_blank" class="remove">Remove</a>\n            '
}function l(){return'\n                <a href="/auth/lastfm/popup" target="_blank" class="connect">Connect</a>\n            '}this.compilerInfo=[4,">= 1.0.0"],r=this.merge(r,t.helpers),i=i||{};var c,h="",d="function",f=this.escapeExpression,y=this;return h+='<article class="dropbox">\n    <h4>Dropbox</h4>\n        <p>\n            ',c=r["if"].call(e,e&&e.dropbox,{hash:{},inverse:y.program(3,o,i),fn:y.program(1,s,i),data:i}),(c||0===c)&&(h+=c),h+='\n        </p>\n</article>\n\n\n<article class="facebook">\n    <h4>Facebook</h4>\n        <p>\n            ',c=r["if"].call(e,e&&e.facebook,{hash:{},inverse:y.program(7,u,i),fn:y.program(5,a,i),data:i}),(c||0===c)&&(h+=c),h+='\n        </p>\n</article>\n\n\n<article class="lastfm">\n    <h4>Lastfm</h4>\n        <p>\n            ',c=r["if"].call(e,e&&e.lastfm,{hash:{},inverse:y.program(11,l,i),fn:y.program(9,p,i),data:i}),(c||0===c)&&(h+=c),h+="\n        </p>\n</article>\n"});"function"==typeof define&&define.amd?define([],function(){return n}):"object"==typeof r&&r&&r.exports&&(r.exports=n)}),require.register("templates/sidebars/item",function(t,e,r){var n=Handlebars.template(function(t,e,r,n,i){function s(t,e){var n,i,s="";return s+='\n    <span class="button ',(i=r.className)?n=i.call(t,{hash:{},data:e}):(i=t&&t.className,n=typeof i===l?i.call(t,{hash:{},data:e}):i),s+=c(n)+" icon-"+c((n=t&&t.button,n=null==n||n===!1?n:n.icon,typeof n===l?n.apply(t):n))+'" title="'+c((n=t&&t.button,n=null==n||n===!1?n:n.title,typeof n===l?n.apply(t):n))+'"></span>\n'}function o(t,e){var n,i,s="";return s+='\n        <i class="icon-',(i=r.icon)?n=i.call(t,{hash:{},data:e}):(i=t&&t.icon,n=typeof i===l?i.call(t,{hash:{},data:e}):i),s+=c(n)+'"></i>\n    '}this.compilerInfo=[4,">= 1.0.0"],r=this.merge(r,t.helpers),i=i||{};var a,u,p="",l="function",c=this.escapeExpression,h=this;return p+="\n",a=r["if"].call(e,e&&e.button,{hash:{},inverse:h.noop,fn:h.program(1,s,i),data:i}),(a||0===a)&&(p+=a),p+='\n\n<a href="',(u=r.url)?a=u.call(e,{hash:{},data:i}):(u=e&&e.url,a=typeof u===l?u.call(e,{hash:{},data:i}):u),p+=c(a)+'">\n    ',a=r["if"].call(e,e&&e.icon,{hash:{},inverse:h.noop,fn:h.program(3,o,i),data:i}),(a||0===a)&&(p+=a),p+="\n    ",(u=r.name)?a=u.call(e,{hash:{},data:i}):(u=e&&e.name,a=typeof u===l?u.call(e,{hash:{},data:i}):u),p+=c(a)+"\n</a>\n"});"function"==typeof define&&define.amd?define([],function(){return n}):"object"==typeof r&&r&&r.exports&&(r.exports=n)}),require.register("templates/sidebars/user",function(t,e,r){var n=Handlebars.template(function(t,e,r,n,i){function s(t,e){var n,i,s="";return s+='<img src="',(i=r.picture)?n=i.call(t,{hash:{},data:e}):(i=t&&t.picture,n=typeof i===u?i.call(t,{hash:{},data:e}):i),s+=p(n)+'" />'}this.compilerInfo=[4,">= 1.0.0"],r=this.merge(r,t.helpers),i=i||{};var o,a="",u="function",p=this.escapeExpression,l=this;return a+='<div class="picture">',o=r["if"].call(e,e&&e.picture,{hash:{},inverse:l.noop,fn:l.program(1,s,i),data:i}),(o||0===o)&&(a+=o),a+="</div>\n"});"function"==typeof define&&define.amd?define([],function(){return n}):"object"==typeof r&&r&&r.exports&&(r.exports=n)}),require.register("templates/sidebars/youtube_add_dialog",function(t,e,r){var n=Handlebars.template(function(t,e,r,n,i){return this.compilerInfo=[4,">= 1.0.0"],r=this.merge(r,t.helpers),i=i||{},'<div class="body">\n    <h2>Add a YouTube music video</h2>\n    <p>\n        <input placeholder="Enter YouTube URL" />\n        <button>Add to my collection</button>\n    </p>\n</div>\n'});"function"==typeof define&&define.amd?define([],function(){return n}):"object"==typeof r&&r&&r.exports&&(r.exports=n)}),require.register("templates/ui/menu_item",function(t,e,r){var n=Handlebars.template(function(t,e,r,n,i){function s(t,e){var n,i,s="";return s+='\n    <i class="icon-',(i=r.icon)?n=i.call(t,{hash:{},data:e}):(i=t&&t.icon,n=typeof i===p?i.call(t,{hash:{},data:e}):i),s+=l(n)+'"></i>\n'}this.compilerInfo=[4,">= 1.0.0"],r=this.merge(r,t.helpers),i=i||{};var o,a,u="",p="function",l=this.escapeExpression,c=this;return o=r["if"].call(e,e&&e.icon,{hash:{},inverse:c.noop,fn:c.program(1,s,i),data:i}),(o||0===o)&&(u+=o),u+='\n\n<span class="name">',(a=r.label)?o=a.call(e,{hash:{},data:i}):(a=e&&e.label,o=typeof a===p?a.call(e,{hash:{},data:i}):a),u+=l(o)+"</span>\n"});"function"==typeof define&&define.amd?define([],function(){return n}):"object"==typeof r&&r&&r.exports&&(r.exports=n)}),require.register("utils",function(t,e,r){r.exports={escapeRegExp:function(t){return t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},timed:function(t,e){return function(){var r;return console.time(t),r=e(Array.prototype.slice(arguments)),console.timeEnd(t),r}}}}),require.register("views/artist/album_track_view",function(t,e,r){var n,i,s,o,a,u,p=function(t,e){return function(){return t.apply(e,arguments)}},l={}.hasOwnProperty,c=function(t,e){function r(){this.constructor=t}for(var n in e)l.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};s=e("views/ui/dnd").DraggableView,a=e("pubsub"),u=e("templates/artist/track"),o=e("views/artist/video_list_view"),n=e("views/artist/video_views").AlbumTrackVideoView,i=function(t){function e(){return this.toggleVideos=p(this.toggleVideos,this),this.getDragged=p(this.getDragged,this),this.setPlayingState=p(this.setPlayingState,this),e.__super__.constructor.apply(this,arguments)}return c(e,t),e.prototype.className="track",e.prototype.template=u,e.prototype.events={"click h4":"toggleVideos"},e.prototype.initialize=function(t){return t=t||{},null==t.draggableSelector&&(t.draggableSelector="h4"),e.__super__.initialize.call(this,t),this.listenTo(a.player,"change:state",this.setPlayingState)},e.prototype.setPlayingState=function(){var t,e;return t=null!=(e=a.player.get("track"))?e.equals(this.model.toCloudtunesTrack()):void 0,t?this.$el.addClass("playing"):this.$el.removeClass("playing")},e.prototype.render=function(){return e.__super__.render.call(this),this.setPlayingState(),this},e.prototype.getDragged=function(){return this.model},e.prototype.toggleVideos=function(){var t,e;return t=this.$(".videos"),t.text("finding track…"),e=this.$(".videos-wrap"),e.hasClass("open")?void e.removeClass("open"):(e.addClass("open"),$.when(this.model.videos.ensureFetched()).then(function(e){return function(){return t.width(160*e.model.videos.length),t.html(""),e.subview("videos",new o({el:t,collection:e.model.videos,VideoView:n})).render()}}(this)))},e}(s),r.exports=i}),require.register("views/artist/album_view",function(t,e,r){var n,i,s,o,a,u,p=function(t,e){return function(){return t.apply(e,arguments)}},l={}.hasOwnProperty,c=function(t,e){function r(){this.constructor=t}for(var n in e)l.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};o=e("mvc").View,a=e("pubsub"),u=e("templates/artist/album"),n=e("views/artist/album_track_view"),s=e("views/ui/dnd").DraggableView,i=function(t){function e(){return this.setPlayingState=p(this.setPlayingState,this),e.__super__.constructor.apply(this,arguments)}return c(e,t),e.prototype.template=u,e.prototype.tagName="article",e.prototype.className="album",e.prototype.events={"click h3":"toggleAlbum","click .play-all":"playTracks","click .add-all":"addTracks"},e.prototype.initialize=function(t){return t=t||{},null==t.draggableSelector&&(t.draggableSelector="h3"),e.__super__.initialize.call(this,t),this.listenTo(a.player,"change:state",this.setPlayingState)},e.prototype.render=function(){return e.__super__.render.call(this),this.setPlayingState(),this},e.prototype.getDragged=function(){return this.model},e.prototype.setPlayingState=function(){var t;return t=a.player.get("track"),t&&t.get("album_mbid")===this.model.id?this.$el.addClass("playing"):this.$el.removeClass("playing")},e.prototype.toggleAlbum=function(){var t,e;return t=this.$el.find(".body"),this.$el.hasClass("open")?void this.$el.removeClass("open"):(this.$el.addClass("open"),e=this.$el.find(".tracklist").text("loading tracklist…"),$.when(this.model.tracks.ensureFetched()).then(function(t){return function(){return e.text(""),t.model.tracks.each(function(e){var r;return r=new n({model:e}),t.$el.find(".tracklist").append(t.subview("track-"+e.id,r).render().el)}),t.$el.addClass("loaded")}}(this)))},e.prototype.playTracks=function(){return this.model.getCloudtunesTracks().done(function(t){return a.player.replaceQueue(t),a.player.play()})},e.prototype.addTracks=function(){return console.log("addTracks")},e}(s),r.exports=i}),require.register("views/artist/artist_page_view",function(t,e,r){var n,i,s,o,a,u,p={}.hasOwnProperty,l=function(t,e){function r(){this.constructor=t}for(var n in e)p.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};u=e("templates/page"),i=e("views/base_content_page_view"),a=e("views/artist/top_tracks_view"),s=e("views/artist/discography_view"),o=e("views/artist/similar_artists_view"),n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return l(e,t),e.prototype.id="artist",e.prototype.className="content-page",e.prototype.template=u,e.prototype.pageName="Loading…",e.prototype.pageURL="artist/",e.prototype.sections=[a,s,o],e.prototype.initialize=function(t){return this.pageURL+=this.model.id,this.listenTo(this.model,"change:name",function(t){return function(){return t.$("h2").text(t.model.get("name")),t.renderSection()}}(this)),this.model.ensureFetched(),e.__super__.initialize.call(this,t)},e}(i),r.exports=n}),require.register("views/artist/discography_view",function(t,e,r){var n,i,s,o={}.hasOwnProperty,a=function(t,e){function r(){this.constructor=t}for(var n in e)o.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};s=e("views/page_section_view"),n=e("views/artist/album_view"),i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return a(e,t),e.prototype.url="discography",e.prototype.className="discography",e.prototype.name="Discography",e.prototype.initialize=function(t){return e.__super__.initialize.call(this,t)},e.prototype.render=function(){return this.model.albums.each(function(t){return function(e){var r;return r=new n({model:e}),t.$el.append(t.subview("album-"+e.id,r).render().el)}}(this)),this.model.albums.length||this.$el.text("No albums found :("),this},e}(s),r.exports=i}),require.register("views/artist/similar_artists_view",function(t,e,r){var n,i,s,o,a=function(t,e){return function(){return t.apply(e,arguments)}},u={}.hasOwnProperty,p=function(t,e){function r(){this.constructor=t}for(var n in e)u.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};n=e("views/page_section_view"),s=e("views/artist/video_list_view"),o=e("templates/artist/artist_list"),i=function(t){function e(){return this.getTemplateData=a(this.getTemplateData,this),e.__super__.constructor.apply(this,arguments)}return p(e,t),e.prototype.url="similar",e.prototype.className="similar-artists",e.prototype.name="Similar Artists",e.prototype.template=o,e.prototype.getTemplateData=function(){return{artists:this.model.getSimilar()}},e}(n),r.exports=i}),require.register("views/artist/top_tracks_view",function(t,e,r){var n,i,s,o,a,u,p,l={}.hasOwnProperty,c=function(t,e){function r(){this.constructor=t}for(var n in e)l.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},h=function(t,e){return function(){return t.apply(e,arguments)}};i=e("mvc").Collection,s=e("views/page_section_view"),a=e("views/artist/video_views").TopTrackVideoView,n=e("views/base_list_view"),p=function(t){return'<tr class="item" data-track="'+t.cid+'" draggable="true">\n    <td><img height="45" src="'+t.get("video").get("thumbnail").sqDefault+'" /></td>\n    <td>'+_.escape(t.get("title"))+"</td>\n</tr>\n"},o=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return c(e,t),e.prototype.tagName="table",e.prototype.className="playable-list",e.prototype.initialize=function(t){var r;return e.__super__.initialize.call(this,t),this.tracks=new i(function(){var t,e,n,i;for(n=this.collection.models,i=[],t=0,e=n.length;e>t;t++)r=n[t],i.push(r.toCloudtunesTrack());return i}.call(this))},e.prototype.getTracks=function(){return this.tracks.models},e.prototype.getDragged=function(){var t;return t=this.tracks.get(this.$selectedItem.data("track")),[t.clone()]},e.prototype.handlePlay=function(t){var e,r;return e=$(t.currentTarget),r=e.data("track"),this.play(r)},e.prototype.render=function(){var t,r;return e.__super__.render.apply(this,arguments),t=function(){var t,e,n,i;for(n=this.getTracks(),i=[],t=0,e=n.length;e>t;t++)r=n[t],i.push(p(r));return i}.call(this).join("\n"),this.$el.html(t),this},e}(n),u=function(t){function e(){return this.render=h(this.render,this),e.__super__.constructor.apply(this,arguments)}return c(e,t),e.prototype.url="tracks",e.prototype.className="top-tracks",e.prototype.name="Top Music Videos",e.prototype.initialize=function(t){return e.__super__.initialize.call(this,t),this.model.videos.fetch({success:this.render})},e.prototype.render=function(){return this.$el.html("").append(new o({collection:this.model.videos}).render().el),this},e}(s),r.exports=u}),require.register("views/artist/video_list_view",function(t,e,r){var n,i,s=function(t,e){return function(){return t.apply(e,arguments)}},o={}.hasOwnProperty,a=function(t,e){function r(){this.constructor=t}for(var n in e)o.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};i=e("mvc").View,n=function(t){function e(){return this.render=s(this.render,this),e.__super__.constructor.apply(this,arguments)}return a(e,t),e.prototype.initialize=function(t){return this.VideoView=t.VideoView,t},e.prototype.render=function(){return this.collection.each(function(t){return function(e){var r;return r=new t.VideoView({model:e}),t.$el.append(t.subview("video-"+e.id,r).render().el)}}(this)),this},e}(i),r.exports=n}),require.register("views/artist/video_views",function(t,e,r){var n,i,s,o,a,u,p,l=function(t,e){return function(){return t.apply(e,arguments)}},c={}.hasOwnProperty,h=function(t,e){function r(){this.constructor=t}for(var n in e)c.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};a=e("mvc").View,u=e("pubsub"),p=e("templates/artist/video"),s=e("views/ui/dnd").DraggableView,i=function(t){function e(){return this.setPlayingState=l(this.setPlayingState,this),e.__super__.constructor.apply(this,arguments)}return h(e,t),e.prototype.template=p,e.prototype.tagName="article",e.prototype.className="video",e.prototype.events={click:"play"},e.prototype.initialize=function(t){return e.__super__.initialize.call(this,t),this.listenTo(u.player,"change:state",this.setPlayingState)},e.prototype.render=function(){return e.__super__.render.call(this),this.setPlayingState(),this},e.prototype.setPlayingState=function(){var t,e;return t=(null!=(e=u.player.get("track"))?e.get("source_id"):void 0)===this.model.id,t?this.$el.addClass("playing"):this.$el.removeClass("playing")},e.prototype.getDragged=function(){return[this.model.toCloudtunesTrack()]},e}(s),n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return h(e,t),e.prototype.play=function(){var t;return t=this.model.toCloudtunesTrack(),u.player.replaceQueue([t]),u.player.play()},e}(i),o=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return h(e,t),e.prototype.play=function(){var t;return t=this.model.collection.mbartist.getLibraryTopTracks(),u.player.replaceQueue(t),u.player.play(this.model.toCloudtunesTrack())},e}(i),r.exports={AlbumTrackVideoView:n,TopTrackVideoView:o}}),require.register("views/base_content_page_view",function(t,e,r){var n,i,s,o,a,u={}.hasOwnProperty,p=function(t,e){function r(){this.constructor=t}for(var n in e)u.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};a=e("mvc"),s=a.View,i=a.PageView,o=e("templates/page"),n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return p(e,t),e.prototype.template=o,e.prototype.className="content-page",e.prototype.pageName=null,e.prototype.pageURL=null,e.prototype.sections=null,e.prototype.sectionsByURL=null,e.prototype.initialize=function(t){var r,n,i,s;for(this.sectionsByURL={},s=this.getSections(),n=0,i=s.length;i>n;n++)r=s[n],this.sectionsByURL[r.prototype.url]=r;return e.__super__.initialize.call(this,t)},e.prototype.getSections=function(){return this.sections},e.prototype.getTemplateData=function(){var t;return{pageName:this.pageName,pageURL:this.pageURL,sections:function(){var e,r,n,i;for(n=this.getSections(),i=[],e=0,r=n.length;r>e;e++)t=n[e],i.push({name:t.prototype.name,className:t.prototype.className,url:this.pageURL?"/"+this.pageURL+"/"+t.prototype.url:"/"+t.prototype.url});return i}.call(this)}},e.prototype.renderSection=function(){var t,e,r;return r=this.sectionsByURL[this.options.section],r||(t=this.getSections()[0],Backbone.history.navigate(t.prototype.url),r=t),e=new r({model:this.model}),this.$(".content").append(e.render().el),this.$("nav a."+e.className).addClass("active"),this.subview("section",e)},e}(i),r.exports=n}),require.register("views/base_list_view",function(t,e,r){var n,i,s,o,a,u=function(t,e){return function(){return t.apply(e,arguments)}},p={}.hasOwnProperty,l=function(t,e){function r(){this.constructor=t}for(var n in e)p.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};o=e("mvc").View,a=e("pubsub"),s=e("views/ui/focus_context_view"),i=e("views/ui/dnd").DraggableView,n=function(t){function e(){return this.getDragged=u(this.getDragged,this),this.handlePlay=u(this.handlePlay,this),e.__super__.constructor.apply(this,arguments)}return l(e,t),e.prototype.events={"mousedown .item":"mousedown","dblclick .item":"handlePlay"},e.prototype.initialize=function(t){return e.__super__.initialize.call(this,t),this.$body=this.getBody(),this.subview(new s({delegate:this,el:this.$body})),this.subview("draggable",new i({delegate:this,draggableSelector:".item",el:this.el}))},e.prototype.getBody=function(){return this.$el},e.prototype.render=function(){return e.__super__.render.apply(this,arguments),this.$selectedItem=null,this},e.prototype.handlePlay=function(){return this.play()},e.prototype.getTracks=function(){throw"not implemented"},e.prototype.play=function(t){var e,r;return null==t&&(t=null),r=this.getTracks(),e=t?_.findWhere(r,{cid:t}):null,a.player.replaceQueue(r),a.player.play(e)},e.prototype.mousedown=function(t){var e;return e=$(t.currentTarget),this.selectItem(e)},e.prototype.getDragged=function(){throw"not implemented"},e.prototype.selectItem=function(t){var e,r,n;return null!=(n=this.$selectedItem)&&n.removeClass("selected"),(null!=t?t.length:void 0)&&(t.addClass("selected"),this.$selectedItem=t,e=this.$body.height(),r=t.position().top,0>r||r>e)?this.$body.scrollTop(t[0].offsetTop-e/2):void 0},e.prototype.focus=function(){return console.log("FOCUS",this.$selectedItem,this),e.__super__.focus.apply(this,arguments),this.$selectedItem?void 0:this.selectItem(this.$body.find(".item:first"))},e.prototype._navigate=function(t){var e;switch(t){case"next":e=this.$selectedItem.next(".item:first");break;case"prev":e=this.$selectedItem.prev(".item:first");break;default:throw"no where "+t}if(e.length)return this.selectItem(e),window.clearTimeout(this._timerSelectNextItem),this._timerSelectNextItem=window.setTimeout(function(){return e.trigger("mousedown")},200)},e.prototype.selectPrevItem=function(){return this._navigate("prev")},e.prototype.selectNextItem=function(){return this._navigate("next")},e.prototype.addItem=function(){},e.prototype.removeItem=function(){},e.prototype.changeItem=function(){},e}(o),r.exports=n}),require.register("views/explore/explore_artists_sections",function(t,e,r){var n,i,s,o,a,u,p,l,c,h={}.hasOwnProperty,d=function(t,e){function r(){this.constructor=t}for(var n in e)h.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},f=function(t,e){return function(){return t.apply(e,arguments)}};p=e("views/page_section_view"),c=e("templates/artist/artist_list"),a=e("models/mb/artist"),s=e("mvc").Collection,n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return d(e,t),e.prototype.model=a,e}(s),i=function(t){function e(){return this.getTemplateData=f(this.getTemplateData,this),e.__super__.constructor.apply(this,arguments)}return d(e,t),e.prototype.template=c,e.prototype.initialize=function(t){return e.__super__.initialize.call(this,t),this.artists=new n,this.artists.url=this.endpoint,this.artists.fetch({success:this.render})},e.prototype.getTemplateData=function(){return{artists:this.artists.toJSON()}},e}(p),o=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return d(e,t),e.prototype.name="Top",e.prototype.url="top",e.prototype.className="top",e.prototype.artsitsChart="top",e.prototype.endpoint="/api/explore/artists/top",e}(i),l=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return d(e,t),e.prototype.name="Trending",e.prototype.url="trending",e.prototype.className="trending",e.prototype.endpoint="/api/explore/artists/trending",e}(i),u=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return d(e,t),e.prototype.name="Recommended",e.prototype.url="",e.prototype.className="recommended",e.prototype.endpoint="/api/explore/artists/recommended",e}(i),r.exports={HotArtistsSectionView:o,TrendingArtistsSectionView:l,RecommendedArtistsSectionView:u}}),require.register("views/explore/explore_page_view",function(t,e,r){var n,i,s,o,a,u,p,l={}.hasOwnProperty,c=function(t,e){function r(){this.constructor=t}for(var n in e)l.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};u=e("pubsub"),n=e("views/base_content_page_view"),p=e("views/explore/explore_artists_sections"),s=p.HotArtistsSectionView,a=p.TrendingArtistsSectionView,o=p.RecommendedArtistsSectionView,i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return c(e,t),e.prototype.id="explore",e.prototype.pageName="Explore",e.prototype.pageURL="",e.prototype.sections=[o,s,a],e.prototype.render=function(){return e.__super__.render.apply(this,arguments),this.renderSection(),this},e.prototype.getSections=function(){var t;return t=this.sections,this.model.has("lastfm")||(t=t.slice(1)),t},e.prototype.getTemplateData=function(){return _.extend(e.__super__.getTemplateData.apply(this,arguments),{user:this.model})},e}(n),r.exports=i}),require.register("views/layout_view",function(t,e,r){var n,i,s,o,a,u,p,l=function(t,e){return function(){return t.apply(e,arguments)}},c={}.hasOwnProperty,h=function(t,e){function r(){this.constructor=t}for(var n in e)c.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};a=e("pubsub"),o=e("mvc").View,p=e("views/ui/resizer_views"),n=p.ColumnResizer,s=p.RightBoundColumnResizer,u=e("templates/layout"),i=function(t){function e(){return this.handleLinkClicked=l(this.handleLinkClicked,this),this.setPageHeight=l(this.setPageHeight,this),e.__super__.constructor.apply(this,arguments)}return h(e,t),e.prototype.template=u,e.prototype.events={"click a":"handleLinkClicked"},e.prototype.initialize=function(){return e.__super__.initialize.apply(this,arguments),this.listenTo(a.navSidebar,"change:width",this.setNavSidebarWidth),this.listenTo(a.infoSidebar,"change:width",this.setInfoSidebarWidth),$(window).on("resize",this.setPageHeight)},e.prototype.render=function(){return e.__super__.render.apply(this,arguments),this.setPageHeight(),this.setNavSidebarWidth(),this.setInfoSidebarWidth(),this.addNavSidebarResizer(),this.addInfoSidebarResizer()},e.prototype.addNavSidebarResizer=function(){var t;return t=this.subview("sidebar-resizer",new n({el:$(".resize-nav-sidebar"),context:this.$el,value:a.navSidebar.get("width"),relative:!1,min:100,max:400})),t.render(),this.listenTo(t,"resize",function(t){return a.navSidebar.set({width:t})})},e.prototype.addInfoSidebarResizer=function(){var t;return t=this.subview("sidebar-resizer",new s({el:$(".resize-info-sidebar"),context:this.$el,value:a.infoSidebar.get("width"),relative:!1,min:150,max:400})),t.render(),this.listenTo(t,"resize",function(t){return a.infoSidebar.set({width:t})})},e.prototype.setPageHeight=function(){var t;return t=$(window).height(),$("#page, #main").height(t)},e.prototype.handleLinkClicked=function(t){var e,r;return e=$(t.currentTarget),e.attr("target")||e.is(".external")?void 0:(t.preventDefault(),t.stopPropagation(),r=e.attr("href"),Backbone.history.navigate(r,!0))},e.prototype.setNavSidebarWidth=function(){return $("#page").css("margin-left",a.navSidebar.get("width")+"px")},e.prototype.setInfoSidebarWidth=function(){return $("#page").css("margin-right",a.infoSidebar.get("width")+"px")},e}(o),r.exports=i}),require.register("views/page_section_view",function(t,e,r){var n,i,s={}.hasOwnProperty,o=function(t,e){function r(){this.constructor=t}for(var n in e)s.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};i=e("mvc").View,n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return o(e,t),e.prototype.tagName="section",e.prototype.url=null,e}(i),r.exports=n}),require.register("views/player_view",function(t,e,r){var n,i,s,o,a,u,p,l,c,h,d,f,y,m,g,_={}.hasOwnProperty,v=function(t,e){function r(){this.constructor=t}for(var n in e)_.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},b=function(t,e){return function(){return t.apply(e,arguments)}};y=e("pubsub"),h=e("mvc").View,l=e("views/ui/slider_view"),m=e("templates/player"),g=e("templates/player_track"),n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return v(e,t),e.prototype.events={click:"click"},e.prototype.initialize=function(t){return e.__super__.initialize.call(this,t),this.listenTo(this.model,"change:state",this.render),this.listenTo(this.model.queue,"reset",this.render)},e.prototype.click=function(){return this.enabled()?this.action():void 0},e.prototype.render=function(){return this.activated()?this.$el.removeClass("inactive"):this.$el.addClass("inactive"),this},e.prototype.activated=function(){return this.enabled()},e.prototype.enabled=function(){return!0},e}(h),p=function(t){function e(){return this.action=b(this.action,this),e.__super__.constructor.apply(this,arguments)}return v(e,t),e.prototype.initialize=function(t){return e.__super__.initialize.call(this,t),this.listenTo(this.model,"change:repeat",this.render)},e.prototype.action=function(){return this.model.set("repeat",!this.model.get("repeat"))},e.prototype.activated=function(){return this.model.get("repeat")},e}(n),u=function(t){function e(){return this.action=b(this.action,this),e.__super__.constructor.apply(this,arguments)}return v(e,t),e.prototype.action=function(){return this.model.prev()},e.prototype.enabled=function(){return this.model.queue.hasPrev()},e}(n),i=function(t){function e(){return this.action=b(this.action,this),e.__super__.constructor.apply(this,arguments)}return v(e,t),e.prototype.action=function(){return this.model.next()},e.prototype.enabled=function(){return this.model.queue.hasNext()},e}(n),s=function(t){function e(){return this.action=b(this.action,this),this.render=b(this.render,this),e.__super__.constructor.apply(this,arguments)}return v(e,t),e.prototype.render=function(){return e.__super__.render.call(this),this.model.playing()?this.$el.removeClass("icon-play").addClass("icon-pause"):this.$el.removeClass("icon-pause").addClass("icon-play"),this},e.prototype.action=function(){return this.model.toggle()},e.prototype.enabled=function(){return Boolean(this.model.queue.len())},e}(n),d=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return v(e,t),e.prototype.field="volume",e}(l),f=function(t){function e(){return this.render=b(this.render,this),this.close=b(this.close,this),this.unopen=b(this.unopen,this),this.open=b(this.open,this),e.__super__.constructor.apply(this,arguments)}return v(e,t),e.prototype.events={"mouseover .button":"open",mouseout:"unopen"},e.prototype.initialize=function(t){return e.__super__.initialize.call(this,t),this.$popup=this.$(".volume-popup"),this.listenTo(this.model,"change:volume",this.render)},e.prototype.open=function(){return this.$el.removeClass("closed").addClass("open")},e.prototype.unopen=function(t){return this.$el.andSelf().find(t.relatedTarget).length?void 0:(this.$popup.one("transitionend",this.close),this.$el.removeClass("open"))},e.prototype.close=function(){return this.$el.addClass("closed")},e.prototype.render=function(){var t,e,r,n,i,s;return e=["icon-volume-off","icon-volume-down","icon-volume-up"],n=e[0],i=e[1],r=e[2],s=this.model.get("volume"),t=5>s?n:60>s?i:r,console.log("VOLUME:",s,t),this.$(".volume-icon").removeClass(e.join(" ")).addClass(t),this},e}(h),a=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return v(e,t),e.prototype.field="position",e.prototype.initialize=function(t){return e.__super__.initialize.call(this,t),this.$loaded=this.$(".loaded"),this.listenTo(this.model,"change:loaded",function(t){return function(e,r){return t.$loaded.css("width",""+r+"%")}}(this))},e}(l),c=function(t){function e(){return this.selectTrack=b(this.selectTrack,this),this.selectAlbum=b(this.selectAlbum,this),this.selectArtist=b(this.selectArtist,this),e.__super__.constructor.apply(this,arguments)}return v(e,t),e.prototype.template=g,e.prototype.events={"click .artist":"selectArtist","click .album":"selectAlbum","click .title":"selectTrack"},e.prototype.initialize=function(t){return e.__super__.initialize.call(this,t),this.listenTo(this.model,"change:track",this.render)},e.prototype.getTemplateData=function(){var t;return{track:(null!=(t=this.model.get("track"))?t.toJSON():void 0)||{}}},e.prototype.selectArtist=function(){return y.publish("select:artist",this.model.get("track"))},e.prototype.selectAlbum=function(){return y.publish("select:album",this.model.get("track"))},e.prototype.selectTrack=function(){return y.publish("select:track",this.model.get("track"))},e}(h),o=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return v(e,t),e.prototype.template=m,e.prototype.render=function(){var t,r,n,o;e.__super__.render.apply(this,arguments),o={prev:u,next:i,toggle:s,repeat:p,volume:d,position:a,track:c,"volume-widget":f};for(n in o)t=o[n],r=this.$("."+n),this.subview(n,new t({model:this.model,el:r}).render());return this},e}(h),r.exports=o}),require.register("views/playlists/base_list_view",function(t,e,r){var n,i,s={}.hasOwnProperty,o=function(t,e){function r(){this.constructor=t}for(var n in e)s.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};i=e("views/base_list_view"),n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return o(e,t),e.prototype.namespace=null,e.prototype.initialize=function(t){return e.__super__.initialize.call(this,t),this.collection=this.getList(this.model.getPlaylist()),this.listenTo(this.collection,"add",this.addItem),this.listenTo(this.collection,"change",this.changeItem),this.listenTo(this.collection,"remove",this.removeItem),this.listenTo(this.collection,"reset",this.render)},e.prototype.getBody=function(){return this.$(".body:first")},e.prototype.getTracks=function(){return this.model.getTrackList().getResult()},e.prototype.getList=function(t){return t.children[""+this.namespace+"s"]},e}(i),r.exports=n}),require.register("views/playlists/filter_list_views",function(t,e,r){var n,s,o,a,u,p,l,c=function(t,e){return function(){return t.apply(e,arguments)}},h={}.hasOwnProperty,d=function(t,e){function r(){this.constructor=t}for(var n in e)h.call(e,n)&&(t[n]=e[n]);
return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};l=e("pubsub"),a=e("views/playlists/base_list_view"),u=function(t,e){return"<div class='"+t+" item' draggable='true'>"+_.escape(e)+"</div>"},p=function(t,e){var r;return"<div class='"+t+" all item' draggable='true'>\n    All (<span>"+e.length+"</span> "+t+"s)\n</div>"+function(){var n,i,s;for(s=[],n=0,i=e.length;i>n;n++)r=e[n],s.push(u(t,r));return s}().join("")},o=function(t){function e(){return this.unselect=c(this.unselect,this),this.select=c(this.select,this),this.render=c(this.render,this),e.__super__.constructor.apply(this,arguments)}return d(e,t),e.prototype.events=_.extend({"mousedown h2":"unselect"},a.prototype.events),e.prototype.render=function(){return e.__super__.render.apply(this,arguments),this.$body.html(p(this.namespace,this.collection.getResult())),this.select(this.model.get("track"))},e.prototype.addItem=function(t,e){var r,n;return console.log("addItem",i,t,this),n=this.renderItem(t),r=this.getItem(e),r?n.insertBefore(r):this.$body.append(n),this.updateCount()},e.prototype.removeItem=function(t,e){var r;return null!=(r=this.getItem(e))&&r.remove(),this.updateCount()},e.prototype.updateCount=function(){return this.$body.find(".item.all:first span").text(this.collection.getResult().length)},e.prototype.getItem=function(t){var e;return e=this.$body.find(".item:eq("+(t+1)+")"),e.length?e:void 0},e.prototype.renderItem=function(t){return $(this.itemTemplate(this.namespace,t(this.namespace)))},e.prototype.select=function(t){var e;return e=null!=t?t.get(this.namespace):void 0,e?this.$body.find(".item").each(function(t){return function(r,n){return n.textContent===e?(t.selectItem($(n)),!1):void 0}}(this)):this.selectItem(this.$body.find(".item:first"))},e.prototype.unselect=function(){return l.publish("select:"+this.namespace,null)},e.prototype.getDragged=function(){return this.model.getTrackList().getResult()},e}(a),s=function(t){function e(){return this.mousedown=c(this.mousedown,this),e.__super__.constructor.apply(this,arguments)}return d(e,t),e.prototype.namespace="artist",e.prototype.initialize=function(t){return e.__super__.initialize.call(this,t),this.listenTo(this.model,"tracks:reset change:source",this.render),this.listenTo(l,"select:artist",this.select)},e.prototype.mousedown=function(t){var e,r;return e=$(t.currentTarget),this.selectItem(e),r=e.hasClass("all")?null:e.text(),this.model.set({artist:r,album:null})},e}(o),n=function(t){function e(){return this.mousedown=c(this.mousedown,this),e.__super__.constructor.apply(this,arguments)}return d(e,t),e.prototype.namespace="album",e.prototype.initialize=function(t){return e.__super__.initialize.call(this,t),this.listenTo(this.model,"change:artist tracks:reset change:source",this.render),this.listenTo(l,"select:album",this.select)},e.prototype.mousedown=function(t){var e,r;return e=$(t.currentTarget),this.selectItem(e),r=e.hasClass("all")?null:e.text(),this.model.set({album:r})},e}(o),r.exports={AlbumListView:n,ArtistListView:s}}),require.register("views/playlists/play_queue_view",function(t,e,r){var n,i,s,o,a,u,p,l={}.hasOwnProperty,c=function(t,e){function r(){this.constructor=t}for(var n in e)l.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},h=function(t,e){return function(){return t.apply(e,arguments)}};a=e("mvc").View,p=e("templates/playlists/tracklist"),o=e("views/playlists/track_list_view"),u=e("pubsub"),n=e("views/ui/dnd").DroppableView,i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return c(e,t),e.prototype.initialize=function(t){return e.__super__.initialize.call(this,t),this.subview("droppable",new n({delegate:this,droppableSelector:".item",el:this.el}))},e.prototype.play=function(t){var e,r;return r=this.model.getTrackList().getResult(),e=_.findWhere(r,{cid:t}),u.player.play(e)},e.prototype.draghover=function(t){var e,r,n,i;return e=$(t.currentTarget),r=t.originalEvent.offsetY,i=e.height()/2,n=i>r?"above":"bellow",e.removeClass("drop-bellow drop-above").addClass("drop-"+n)},e.prototype.dragleave=function(t){return $(t.currentTarget).removeClass("drop-bellow drop-above")},e.prototype.drop=function(t,e){var r,n,i,s,o;if(console.log("PlayQueueTrackListView.drop",t,e),r=$(e.currentTarget),r.data("track")){if(o=this.model.getTrackList().getResult(),n=_.findWhere(o,{cid:r.data("track")}),s=_.indexOf(o,n),console.log("dragged onto",n.get("title")),r.hasClass("drop-above"))i=s;else{if(!r.hasClass("drop-bellow"))throw"No drop-{above,bellow} class!";i=s+1}return u.player.queue.move(t[0],i)}},e}(o),s=function(t){function e(){return this.render=h(this.render,this),e.__super__.constructor.apply(this,arguments)}return c(e,t),e.prototype.template=p,e.prototype.id="play-queue",e.prototype.className="flat-playlist-body playlist-body",e.prototype.render=function(){return e.__super__.render.apply(this,arguments),this.subview(new i({model:this.model,el:this.$(".tracks"),disableSorting:!0})).render(),this},e}(a),r.exports=s}),require.register("views/playlists/playlist_browse_view",function(t,e,r){var n,i,s,o,a,u,p,l,c,h,d,f=function(t,e){return function(){return t.apply(e,arguments)}},y={}.hasOwnProperty,m=function(t,e){function r(){this.constructor=t}for(var n in e)y.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};l=e("pubsub"),p=e("mvc").View,c=e("templates/playlists/playlist_browse"),h=e("views/ui/resizer_views"),s=h.ColumnResizer,a=h.RowResizer,d=e("views/playlists/filter_list_views"),i=d.ArtistListView,n=d.AlbumListView,u=e("views/playlists/track_list_view"),o=function(t){function e(){return this.render=f(this.render,this),this.updateGridRows=f(this.updateGridRows,this),this.updateGridColumns=f(this.updateGridColumns,this),e.__super__.constructor.apply(this,arguments)}return m(e,t),e.prototype.template=c,e.prototype.id="playlist-browse",e.prototype.className="playlist-body",e.prototype.initialize=function(t){return e.__super__.initialize.call(this,t),this.listenTo(this.model,"change:centerX",this.updateGridColumns),this.listenTo(this.model,"change:centerY",this.updateGridRows)},e.prototype.handleRowResized=function(t){return this.model.set("centerY",t)},e.prototype.handleColumnResized=function(t){return this.model.set("centerX",t)},e.prototype.updateGridColumns=function(){var t,e;return e=this.model.get("centerX"),t=100-e,this.subview("artists").$el.css("width",e+"%"),this.subview("albums").$el.css("width",t+"%")},e.prototype.updateGridRows=function(){var t,e;return t=this.model.get("centerY"),e=100-t,this.subview("artists").$el.css("height",t+"%"),this.subview("albums").$el.css("height",t+"%"),this.subview("tracks").$el.css("height",e+"%")},e.prototype.render=function(){var t,r,o,p,l,c;for(e.__super__.render.apply(this,arguments),this.subview("artists",new i({model:this.model,el:this.$(".artists")})),this.subview("albums",new n({model:this.model,el:this.$(".albums")})),this.subview("tracks",new u({model:this.model,el:this.$(".tracks")})),r=this.subview("resize-row",new a({el:this.$(".resize-row.resize-main-grid"),context:this.$el,value:this.model.get("centerY"),relative:!0,min:100,max:-100})),this.listenTo(r,"resize",this.handleRowResized),t=this.subview("resize-col",new s({el:this.$(".resize-col.resize-main-grid"),value:this.model.get("centerX"),context:this.$el,relative:!0,min:100,max:-100})),this.listenTo(t,"resize",this.handleColumnResized),c=this.subviews,p=0,l=c.length;l>p;p++)o=c[p],o.render();return this.updateGridColumns(),this.updateGridRows(),this},e}(p),r.exports=o}),require.register("views/playlists/playlist_page_view",function(t,e,r){var n,i,s,o,a,u,p,l,c,h,d,f,y,m={}.hasOwnProperty,g=function(t,e){function r(){this.constructor=t}for(var n in e)m.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},v=function(t,e){return function(){return t.apply(e,arguments)}};f=e("pubsub"),y=e("mvc"),i=y.PageView,h=y.View,n=e("views/ui/menu_view"),c=e("models/lists/playlists").UserPlaylist,o=e("views/playlists/playlist_browse_view"),p=e("views/playlists/playlist_view"),s=e("views/playlists/play_queue_view"),d=e("templates/playlists/playlist_header"),a=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return g(e,t),e.prototype.className="playlist-header",e.prototype.tagName="header",e.prototype.template=d,e.prototype.events={"click .options":"openMenu"},e.prototype.initialize=function(){return this.listenTo(this.model,"change",this.render)},e.prototype.getTemplateData=function(){return console.log(this.model.toJSON()),_.extend(this.model.toJSON(),{showOptions:this.model.canRename()||this.model.canDelete()})},e.prototype.openMenu=function(t){var e;return e={},this.model.canRename()&&(e.rename={label:"Rename",icon:"edit",callback:function(t){return function(){var e;return e=prompt("New Name",t.model.get("name")),e?t.model.save({name:e}):void 0}}(this)}),this.model.canDelete()&&(e["delete"]={label:"Delete",icon:"remove",callback:function(t){return function(){return t.model.destroy(),f.router.navigate("/collection",{trigger:!0})}}(this)}),n.fromMouseEvent(t,{actions:e})},e}(h),l=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return g(e,t),e}(a),u=function(t){function e(){return this.render=v(this.render,this),e.__super__.constructor.apply(this,arguments)}return g(e,t),e.prototype.id="playlist",e.prototype.initialize=function(t){return console.log("new PlaylistPageView"),e.__super__.initialize.call(this,t),this.listenTo(this.model,"change:playlist",this.render)},e.prototype.render=function(){var t,r,n,i,u;return e.__super__.render.apply(this,arguments),null!=(i=this.subview("header"))&&i.remove(),null!=(u=this.subview("playlist"))&&u.remove(),r=this.model.getPlaylist(),t=null,"queue"===r.id?(t=l,n=s):(n=r instanceof c?p:o,"all"!==r.id&&(t=a)),t?this.$el.addClass("has-header").append(this.subview("header",new t({model:r})).render().el):this.$el.removeClass("has-header"),this.$el.append(this.subview("playlist",new n({model:this.model})).render().el)},e}(i),r.exports=u}),require.register("views/playlists/playlist_view",function(t,e,r){var n,i,s,o,a=function(t,e){return function(){return t.apply(e,arguments)}},u={}.hasOwnProperty,p=function(t,e){function r(){this.constructor=t}for(var n in e)u.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};s=e("mvc").View,o=e("templates/playlists/tracklist"),i=e("views/playlists/track_list_view"),n=function(t){function e(){return this.render=a(this.render,this),e.__super__.constructor.apply(this,arguments)}return p(e,t),e.prototype.template=o,e.prototype.id="playlist-flat",e.prototype.className="flat-playlist-body playlist-body",e.prototype.render=function(){return e.__super__.render.apply(this,arguments),this.subview(new i({model:this.model,el:this.$(".tracks"),disableSorting:!0})).render(),this},e}(s),r.exports=n}),require.register("views/playlists/track_list_view",function(t,e,r){var n,i,s,o,a,u,p,l,c,h,d={}.hasOwnProperty,f=function(t,e){function r(){this.constructor=t}for(var n in e)d.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},y=function(t,e){return function(){return t.apply(e,arguments)}};h=e("pubsub"),c=e("mvc").View,o=e("views/ui/lazy_renderer"),i=e("views/ui/resizer_views").ColumnResizer,n=e("views/playlists/base_list_view"),u=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return f(e,t),e.prototype.className="resize-col",e.prototype.start=function(t){return this.$el.height(this.getContextSize()+"px"),e.__super__.start.call(this,t)},e.prototype.finish=function(t){return this.$el.height(""),e.__super__.finish.call(this,t)},e.prototype.getLimits=function(){var t,e,r,n,i;return r=45,i=this.prev,n=this.next,e=i?i.getCurrentAbsoluteValue()+r:r,t=n?n.getCurrentAbsoluteValue()-r:this.getContextSize()-r,[e,t]},e}(i),s=function(t){function e(){return this.render=y(this.render,this),e.__super__.constructor.apply(this,arguments)}return f(e,t),e.prototype.initialize=function(t){return e.__super__.initialize.call(this,t),this.listenTo(this.model,"change:trackColumns",this.render),this.addResizers()},e.prototype.addResizers=function(){var t,e,r,n,i,s,o,a,p,l,c,h,d;for(this.resizers=[],i=0,c=this.model.get("trackColumns"),t=o=0,p=c.length;p>o;t=++o)n=c[t],i+=n,s=new u({context:this.$el,value:i,relative:!0}),this.listenTo(s,"resize",this.handleColumnResized),s.$el.appendTo(this.$(".head-wrap")),this.resizers.push(s),this.subview("resize-col-"+t,s.render());for(h=this.resizers,d=[],t=a=0,l=h.length;l>a;t=++a)s=h[t],e=this.resizers[t+1],s.prev=r,s.next=e,d.push(r=s);return d},e.prototype.handleColumnResized=function(){var t,e,r,n,i,s;for(e=[],t=0,s=_.pluck(this.resizers,"value"),n=0,i=s.length;i>n;n++)r=s[n],e.push(r-t),t=r;return this.model.set({trackColumns:e})},e.prototype.render=function(){var t,e,r,n,i,s,o;for(this.$style||(this.$style=$('<style id="tracks-cols" />').appendTo($("head"))),e="\n",n=0,o=this.model.get("trackColumns"),r=i=0,s=o.length;s>i;r=++i)t=o[r],r+=1,n+=t,e+="#playlist .tracks td:nth-child("+r+") {\n    width: "+t+"% !important;\n}";return e+="#playlist .tracks td:nth-child("+(r+1)+") {\n    width: "+(100-n)+"% !important;\n}",this.$style.text(e)},e}(c),p=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return f(e,t),e.prototype.makeRow=function(t){return'<tr class="item" data-track="'+t.cid+'" draggable="true">\n    <td>'+(t.get("number")||"")+"</td>\n    <td>"+_.escape(t.get("title"))+"</td>\n    <td>"+_.escape(t.get("artist"))+"</td>\n    <td>"+_.escape(t.get("album"))+"</td>\n</tr>"},e.prototype.makeTable=function(t){var e,r,n,i,s;for(r=["<table>"],s=t.iter(),n=0,i=s.length;i>n;n++)e=s[n],r.push(this.makeRow(this.collection[e]));return r.push("</table>"),r.join("")},e}(o),l=function(t){function e(){return this.sortBy=y(this.sortBy,this),this.render=y(this.render,this),e.__super__.constructor.apply(this,arguments)}return f(e,t),e.prototype.events={"mousedown td":"sortBy"},e.prototype.initialize=function(t){return e.__super__.initialize.call(this,t),this.listenTo(this.model,"change:sortBy change:ordering",this.render)},e.prototype.render=function(){var t;return this.$el.addClass("sorting-enabled"),this._orig||(this._orig=this.$el.attr("class")),this.$el.attr("class",""+this._orig+" order-"+this.model.get("ordering")),t="sorted-by",this.$("."+t).removeClass(t),this.$("[data-order-field="+this.model.get("sortBy")+"]").addClass(t),this},e.prototype.sortBy=function(t){var e,r;return e=$(t.target),r=e.data("order-field"),r===this.model.get("sortBy")?this.model.toggleOrdering():this.model.set("sortBy",r)},e}(c),a=function(t){function e(){return this.markPlayingItem=y(this.markPlayingItem,this),this.select=y(this.select,this),this.mousedown=y(this.mousedown,this),this.render=y(this.render,this),e.__super__.constructor.apply(this,arguments)}return f(e,t),e.prototype.namespace="track",e.prototype.className="playlist",e.prototype.initialize=function(t){return e.__super__.initialize.call(this,t),this.subview("columnsManager",new s({model:this.model,el:this.el})),t.disableSorting||this.subview("sorting",new l({model:this.model,el:this.$(".head")})).render(),this.listenTo(h.player,"change:track",this.markPlayingItem),this.listenTo(h,"select:artist select:album select:track",this.select)},e.prototype.remove=function(){var t;return null!=(t=this.renderer)&&t.remove(),e.__super__.remove.apply(this,arguments)},e.prototype.render=function(t){var e,r,n,i;return t&&(r=this.renderer.getVisibleRange()),null!=(i=this.renderer)&&i.remove(),this.renderer=new p(this.$body,this.collection.getResult()),this.renderer.renderIntial(r),e=this.$(".head-wrap"),n=this.$el.width()-this.$body[0].scrollWidth,e.css("margin-right",n+"px"),this.select(this.model.get("track")),this.subview("columnsManager").render(),delete this.$playing,this.markPlayingItem(),this},e.prototype.renderFresh=function(){return this.render(!1)},e.prototype.renderOnPosition=function(){return this.render(!0)},e.prototype.updatePlayingTrack=function(){},e.prototype.mousedown=function(t){var e,r;return e=$(t.currentTarget),this.selectItem(e),r=this.model.library.get(e.data("track")),this.model.set({track:r})},e.prototype.getDragged=function(){var t;return t=this.$selectedItem.data("track"),[_.findWhere(this.collection.getTracks(),{cid:t})]},e.prototype.select=function(t){var e;return e=t&&this.getTrackItem(t),e||(e=this.$body.find(".item:first")),this.selectItem(e)},e.prototype.getTrackItem=function(t){var e;return e=this.$body.find("[data-track='"+t.cid+"']:first"),e.length?e:void 0},e.prototype.handlePlay=function(t){var e,r;return e=$(t.currentTarget),this.selectItem(e),r=e.data("track"),this.play(r)},e.prototype.addItem=function(t,e){return this.renderer.addItem(t,e)},e.prototype.removeItem=function(t,e){return this.renderer.removeItem(t,e)},e.prototype.changeItem=function(t,e){return this.renderer.changeItem(t,e)},e.prototype.markPlayingItem=function(){var t,e,r;return t="playing",e=h.player.get("track"),e&&this.$playing&&e.cid===this.$playing.data("track")||(this.$playing&&(this.$playing.removeClass(t),delete this.$playing),!e)?void 0:(this.$playing=this.getTrackItem(e),null!=(r=this.$playing)?r.addClass(t):void 0)},e}(n),r.exports=a}),require.register("views/search/search_form_view",function(t,e,r){var n,i,s,o,a,u,p,l,c,h,d,f,y,m,g,v,b={}.hasOwnProperty,w=function(t,e){function r(){this.constructor=t}for(var n in e)b.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},k=function(t,e){return function(){return t.apply(e,arguments)}};v=e("mvc"),f=v.View,u=v.Model,i=v.Collection,y=e("utils").escapeRegExp,g=e("templates/search/search_suggest"),m=e("pubsub"),a=e("views/ui/focus_context_view"),h=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return w(e,t),e}(u),d=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return w(e,t),e.prototype.model=h,e}(i),l=function(t){function e(){return this.updateSuggestions=k(this.updateSuggestions,this),this.end=k(this.end,this),this.activity=k(this.activity,this),e.__super__.constructor.apply(this,arguments)}return w(e,t),e.prototype.events={"focus #q":"activity","keyup #q":"activity"},e.prototype.initialize=function(t){return e.__super__.initialize.call(this,t),this.$q=this.$("input"),this.suggest=new c({el:this.$(".suggest"),model:this.model}),this.suggest.hide()},e.prototype.activity=function(){return this.$el.addClass("active"),this.updateSuggestions($.trim(this.$q.val()))},e.prototype.activity=_.debounce(e.prototype.activity,500),e.prototype.end=function(){return this.$el.removeClass("active"),this.suggest.hide()},e.prototype.updateSuggestions=function(t){return t?(this.suggest.show(),t!==this.prevQuery?(this.prevQuery=t,this.suggest.render(t)):void 0):this.suggest.hide()},e}(f),p=function(t){function e(){return this.matches=k(this.matches,this),e.__super__.constructor.apply(this,arguments)}return w(e,t),e.prototype.initialize=function(){var t,e;return t=this.get("value"),this.res=function(){var r,n,i,s;for(i=t.split(/\s+/g),s=[],r=0,n=i.length;n>r;r++)e=i[r],s.push(new RegExp(y(e),"i"));return s}()},e.prototype.matches=function(t){return _.all(this.res,function(e){return e.test(t)})},e.prototype.getTagText=function(){return this.get("value")},e.prototype.filter=function(t){var e,r,n,i;for(i=[],r=0,n=t.length;n>r;r++)e=t[r],this.matches(e)&&i.push(e);return i},e}(u),n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return w(e,t),e}(f),s=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return w(e,t),e.prototype.className="suggest-collection",e.prototype.initialize=function(t){return e.__super__.initialize.call(this,t),this.artistNames=this.model.library.tracklist.getArtistList(),this.albums=this.model.library.tracklist.getAlbumList(),this.tracks=this.model.library.tracklist},e.prototype.render=function(t){var e,r,n,i,s,o,a,u,p,l,c,h,d,f;for(o=_.map(this.model.library.playlists.models,function(t){return _.pick(t.attributes,"name","id")}),a={id:"playlists",name:"Playlists",type:"collection:playlist",items:function(){var e,r,n,i;for(n=this.filterItems(t,3,o,"name"),i=[],e=0,r=n.length;r>e;e++)s=n[e],i.push({value:s.id,text:s.name});return i}.call(this)},i={id:"artists",name:"Artists",type:"collection:artist",items:function(){var e,r,i,s;for(i=this.filterItems(t,3,this.artistNames.getResult()),s=[],e=0,r=i.length;r>e;e++)n=i[e],s.push({value:n,text:n});return s}.call(this)},r={id:"albums",name:"Albums",type:"collection:album",items:function(){var r,n,i,s;for(i=this.filterItems(t,3,this.albums.getResult(),"album"),s=[],r=0,n=i.length;n>r;r++)e=i[r],s.push({value:e.album,text:e.album,note:"by "+e.artist});return s}.call(this)},c={id:"tracks",name:"Tracks",type:"collection:track",items:function(){var e,r,n,i;for(n=this.filterItems(t,3,this.tracks.getResult(),"title"),i=[],e=0,r=n.length;r>e;e++)l=n[e],i.push({value:l.id,text:l.get("title"),note:"by "+l.get("artist")+" from "+l.get("album")});return i}.call(this)},p={id:"collection",name:"Collection",showAllLabel:"Show All Results…",sections:[]},f=[a,i,r,c],h=0,d=f.length;d>h;h++)u=f[h],u.items.length&&(this.collection.add(u.items),p.sections.push(u));return p.sections.length?(this.$el.html(g(p)),this.$el.show(),!0):(this.$el.hide(),!1)},e.prototype.filterItems=function(t,e,r,n){var i,s,o,a,u,l,c;for(null==n&&(n=null),a=new p({value:t}),i=0,o=[],l=0,c=r.length;c>l&&(s=r[l],u=n?s[n]:s,!a.matches(u)||(o.push(s),++i!==e));l++);return o},e}(n),o=function(t){function e(){return this.render=k(this.render,this),e.__super__.constructor.apply(this,arguments)}return w(e,t),e.prototype.className="suggest-external",e.prototype.initialize=function(){return this.render=_.debounce(this.render,500)},e.prototype.render=function(t){return $.get("/api/search/suggest",{q:t},function(t){return function(e){var r,n,i,s,o;return i={id:"external",name:"Elsewhere",showAllLabel:"Show All Results…",sections:[]},e.artists.length&&(n={id:"artists",type:"external:artist",name:"Artists",items:function(){var t,n,i,s;for(i=e.artists,s=[],t=0,n=i.length;n>t;t++)r=i[t],s.push({id:r.id,text:r.artist,note:r.note});return s}()},t.collection.add(n.items),i.sections.push(n)),e.tracks.length&&(o={id:"tracks",type:"external:track",name:"Tracks",items:function(){var t,r,n,i;for(n=e.tracks,i=[],t=0,r=n.length;r>t;t++)s=n[t],i.push({id:s.id,text:s.title,note:"by "+s.artist});return i}()},t.collection.add(o.items),i.sections.push(o)),i.sections.length?(t.$el.html(g(i)),t.$el.show(),!0):(t.$el.hide(),!1)}}(this))},e}(n),c=function(t){function e(){return this.navigateToItem=k(this.navigateToItem,this),this.handleItemClick=k(this.handleItemClick,this),this.hide=k(this.hide,this),e.__super__.constructor.apply(this,arguments)}return w(e,t),e.prototype.events={"click .item":"handleItemClick","mouseover .item":"handleItemHover"},e.prototype.initialize=function(t){var r,n;return e.__super__.initialize.call(this,t),this.subview(new a({delegate:this})),this.collection=new d,r=this.subview("collection",new s({model:this.model,collection:this.collection})),n=this.subview("external",new o({model:this.model,collection:this.collection})),this.$el.append(r.el),this.$el.append(n.el)},e.prototype.render=function(t){return t=$.trim(t),t.length>1?_.invoke(this.subviews,"render",t):this.hide()},e.prototype.hide=function(){return this.$el.hide()},e.prototype.show=function(){return this.$el.show()},e.prototype.selectItem=function(t){var e;return null!=(e=this.$selectedItem)&&e.removeClass("selected"),(null!=t?t.length:void 0)?(t.addClass("selected"),this.$selectedItem=t):void 0},e.prototype.selectPrevItem=function(){var t,e;return this.$selectedItem&&(t=this.$(".items"),e=$(t.get(t.index(this.$selectedItem)-1)),e.length)?this.selectedItem(e):void 0},e.prototype.selectNextItem=function(){var t,e;return this.$selectedItem?(t=this.$(".items"),e=$(t.get(t.index(this.$selectedItem)+1)),e.length?this.selectedItem(e):void 0):this.selectItem(this.$(".item:first"))},e.prototype.handleItemHover=function(t){return this.selectItem($(t.currentTarget))},e.prototype.handleItemClick=function(t){var e;return e=$(t.currentTarget),this.navigateToItem(e.data("type"),e.data("item"))},e.prototype.navigateToItem=function(t,e){var r;switch(Backbone.history.navigate("/",!0),t){case"collection:playlist":this.model.library.playlists.selected(this.model.library.playlists.get(e));break;case"collection:artist":m.publish("select:artist",{artist:e});break;case"collection:album":m.publish("select:album",e);break;case"collection:track":r=this.model.library.get(e),m.publish("select:track",r);break;case"external:artist":m.router.navigate("/artist/"+e,!0);break;default:throw"Unknown item "+t}return this.hide()},e}(f),r.exports=l}),require.register("views/search/search_page_view",function(t,e,r){var n,i,s,o,a,u={}.hasOwnProperty,p=function(t,e){function r(){this.constructor=t}for(var n in e)u.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};n=e("mvc").PageView,a=e("templates/search/search_page"),i=e("views/search/search_form_view"),o=e("pubsub"),r.exports=s=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return p(e,t),e.prototype.id="search",e.prototype.template=a,e.prototype.render=function(){return e.__super__.render.apply(this,arguments),this.subview(new i({el:this.$("#search"),model:o.libraryState})).render(),this},e}(n)}),require.register("views/settings/base_settings_section_view",function(t,e,r){var n,i,s=function(t,e){return function(){return t.apply(e,arguments)}},o={}.hasOwnProperty,a=function(t,e){function r(){this.constructor=t}for(var n in e)o.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};i=e("views/page_section_view"),n=function(t){function e(){return this.submit=s(this.submit,this),e.__super__.constructor.apply(this,arguments)}return a(e,t),e.prototype.tagName="section",e.prototype.events={"submit form":"submit"},e.prototype.getTemplateData=function(){return this.model.attributes},e.prototype.getFormData=function(){var t,e,r,n,i,s,o;for(t={},o=this.fieldNames,i=0,s=o.length;s>i;i++)r=o[i],e=this.$("[name="+r+"]"),n=e.is("[type=checkbox]")?e.is(":checked"):e.val(),t[r]=n;return t},e.prototype.submit=function(){var t;return t=this.getFormData(),this.model.save(t),!1},e}(i),r.exports=n}),require.register("views/settings/notifications_view",function(t,e,r){var n,i,s,o={}.hasOwnProperty,a=function(t,e){function r(){this.constructor=t}for(var n in e)o.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};n=e("views/settings/base_settings_section_view"),s=e("templates/settings/notifications"),i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return a(e,t),e.prototype.className="notifications",e.prototype.url="notifications",e.prototype.name="Notifications",e.prototype.template=s,e.prototype.fieldNames=["desktop_notifications","confirm_exit"],e.prototype.events={"change input":"submit"},e}(n),r.exports=i}),require.register("views/settings/profile_view",function(t,e,r){var n,i,s,o={}.hasOwnProperty,a=function(t,e){function r(){this.constructor=t}for(var n in e)o.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};n=e("views/settings/base_settings_section_view"),s=e("templates/settings/profile"),i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return a(e,t),e.prototype.name="Profile",e.prototype.className="profile",e.prototype.url="profile",e.prototype.template=s,e.prototype.fieldNames=["username","picture","location","email","name"],e.prototype.events=_.extend({"click .picture img":"selectImage"},n.prototype.events),e.prototype.getTemplateData=function(){var t,r,n,i,s,o,a;for(i=[],a=["facebook","lastfm"],s=0,o=a.length;o>s;s++)r=a[s],n=this.model.get(r),i.push(n?{id:r,connected:!0,name:n.name,picture:n.picture,selected:n.picture===this.model.get("picture")}:{id:r,connected:!1,name:r,picture:null,selected:!1});return t=e.__super__.getTemplateData.apply(this,arguments),t.services=i,t},e.prototype.selectImage=function(t){var e;return e=$(t.currentTarget),this.$(".picture img").removeClass("selected"),e.addClass("selected"),this.model.save("picture",e.attr("src"))},e}(n),r.exports=i}),require.register("views/settings/settings_page_view",function(t,e,r){var n,i,s,o,a,u,p={}.hasOwnProperty,l=function(t,e){function r(){this.constructor=t}for(var n in e)p.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};u=e("pubsub"),n=e("views/base_content_page_view"),s=e("views/settings/profile_view"),a=e("views/settings/social_view"),i=e("views/settings/notifications_view"),o=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return l(e,t),e.prototype.id="settings",e.prototype.pageName="Settings",e.prototype.pageURL="settings",e.prototype.sections=[s,a,i],e.prototype.render=function(){return e.__super__.render.apply(this,arguments),this.renderSection()},e.prototype.getTemplateData=function(){return _.extend(e.__super__.getTemplateData.apply(this,arguments),{user:this.model})},e}(n),r.exports=o}),require.register("views/settings/social_view",function(t,e,r){var n,i,s,o={}.hasOwnProperty,a=function(t,e){function r(){this.constructor=t}for(var n in e)o.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};n=e("views/settings/base_settings_section_view"),s=e("templates/settings/social"),i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return a(e,t),e.prototype.className="social",e.prototype.url="social",e.prototype.name="Social",e.prototype.template=s,e.prototype.events={"click .connect":"connectService","click .remove":"removeService"},e.prototype.initialize=function(t){return e.__super__.initialize.call(this,t),this.listenTo(this.model,"change",this.render)},e.prototype.connectService=function(t){var e,r,n,i;return i=650,e=350,r=screen.width/2-i/2,n=screen.height/2-e/2,window.open(t.currentTarget.href,"_blank","width="+i+", height="+e+", left="+r+", top="+n),!1},e.prototype.removeService=function(t){return $.ajax({url:t.currentTarget.href,type:"DELETE"}),!1},e}(n),r.exports=i}),require.register("views/sidebars/base",function(t,e,r){var n,i,s=function(t,e){return function(){return t.apply(e,arguments)}},o={}.hasOwnProperty,a=function(t,e){function r(){this.constructor=t}for(var n in e)o.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};i=e("mvc").View,n=function(t){function e(){return this.setDimensions=s(this.setDimensions,this),e.__super__.constructor.apply(this,arguments)}return a(e,t),e.prototype.initialize=function(t){return e.__super__.initialize.call(this,t),this.listenTo(this.model,"change:width",this.setDimensions),$(window).on("resize",this.setDimensions),this.setDimensions()},e.prototype.setDimensions=function(){var t;return t=this.model.get("width"),this.$el.width(t)},e}(i),r.exports=n}),require.register("views/sidebars/info_sidebar_view",function(t,e,r){var n,i,s,o=function(t,e){return function(){return t.apply(e,arguments)}},a={}.hasOwnProperty,u=function(t,e){function r(){this.constructor=t}for(var n in e)a.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};s=e("mvc").View,n=e("views/sidebars/base"),i=function(t){function e(){return this.setDimensions=o(this.setDimensions,this),e.__super__.constructor.apply(this,arguments)}return u(e,t),e.prototype.initialize=function(t){return e.__super__.initialize.call(this,t)},e.prototype.setDimensions=function(){var t;return e.__super__.setDimensions.apply(this,arguments),t=this.model.get("width"),this.$("#medium").height(t)
},e}(n),r.exports=i}),require.register("views/sidebars/nav_sidebar_view",function(t,e,r){var n,i,s,o,a,u,p,l,c,h,d,f,y,m,g,v,b,w,k,x,$,T,C,P,I,z,S,q=function(t,e){return function(){return t.apply(e,arguments)}},R={}.hasOwnProperty,V=function(t,e){function r(){this.constructor=t}for(var n in e)R.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};l=e("views/ui/focus_context_view"),w=e("mvc").View,P=e("pubsub"),S=e("source_ids"),o=S.DROPBOX,k=S.YOUTUBE,u=e("views/ui/dnd").DroppableView,g=e("models/lists/playlists").UserPlaylist,T=e("templates/sidebars/youtube_add_dialog"),C=e("templates/sidebars/item"),z=e("templates/sidebars/user"),i=e("views/sidebars/base"),I=io.connect("http:///sync"),$=function(t){function e(){return this.submit=q(this.submit,this),this.prevent=q(this.prevent,this),e.__super__.constructor.apply(this,arguments)}return V(e,t),e.prototype.className="dialog modal",e.prototype.template=T,e.prototype.container="body",e.prototype.events={click:"remove","click button":"submit","click .body":"prevent"},e.prototype.prevent=function(){return!1},e.prototype.submit=function(){var t,e;return t=this.$("input"),e=t.val(),e?(this.remove(),I.emit("add_url",{url:e})):t.focus(),!1},e}(w),m=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return V(e,t),e.prototype.tagName="li",e.prototype.className="item",e.prototype.template=C,e.prototype.events={mousedown:"activate","mousedown .button":"buttonClicked"},e.prototype.activate=function(){return P.router.navigate(this.$("a").attr("href"),{trigger:!0})},e}(w),p=function(t){function e(){return this.render=q(this.render,this),e.__super__.constructor.apply(this,arguments)}return V(e,t),e.prototype.initialize=function(){return e.__super__.initialize.apply(this,arguments),this.listenTo(P.router,"route",this.render),this.listenTo(P.user.library.playlists,"change:selected",function(t){return function(){return t.$el.removeClass("selected")}}(this))},e.prototype.render=function(){return e.__super__.render.apply(this,arguments),_.contains(["","trending"],Backbone.history.fragment)&&this.$el.addClass("selected"),this},e.prototype.getTemplateData=function(){return{url:"/",icon:"compass",name:"Explore",button:null}},e}(m),y=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return V(e,t),e.prototype.getTemplateData=function(){return{url:"/search",icon:"search",name:"Search",button:null}},e}(m),d=function(t){function e(){return this.render=q(this.render,this),e.__super__.constructor.apply(this,arguments)}return V(e,t),e.prototype.initialize=function(t){return e.__super__.initialize.call(this,t),this.model.acceptsTracks()?this.subview("droppable",new u({delegate:this,el:this.el})):void 0},e.prototype.render=function(){return e.__super__.render.apply(this,arguments),this.setClasses(),this},e.prototype.getTemplateData=function(){return{url:this.model.getRoute(),icon:this.model.get("icon"),name:this.model.get("name")}},e.prototype.setClasses=function(){return this.model.get("selected")?this.$el.addClass("selected"):this.$el.removeClass("selected"),this.model.acceptsTracks()?this.$el.addClass("accepts-tracks"):void 0},e.prototype.drop=function(t){if(console.log("tracksDropped",this,t),!this.model.acceptsTracks())throw"!";return this.model.addTracks(t)},e}(m),f=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return V(e,t),e.prototype.render=function(){return e.__super__.render.apply(this,arguments),this.setClasses(),this},e}(d),x=function(t){function e(){return this.render=q(this.render,this),this.buttonClicked=q(this.buttonClicked,this),e.__super__.constructor.apply(this,arguments)}return V(e,t),e.prototype.buttonClicked=function(){return(new $).render()},e.prototype.getTemplateData=function(){var t;return t=e.__super__.getTemplateData.apply(this,arguments),t.icon="youtube",t.button={title:"Add YouTube song",className:"add",icon:"plus-sign"},t},e.prototype.render=function(){return e.__super__.render.apply(this,arguments)},e}(d),n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return V(e,t),e}(d),a=function(t){function e(){return this.startSync=q(this.startSync,this),this.buttonClicked=q(this.buttonClicked,this),e.__super__.constructor.apply(this,arguments)}return V(e,t),e.prototype.getTemplateData=function(){var t;return t=e.__super__.getTemplateData.apply(this,arguments),t.button={title:"Sync Dropbox",className:"sync",icon:"refresh"},t},e.prototype.buttonClicked=function(){return P.user.has("dropbox")?this.startSync():P.router.navigate("settings/social",{trigger:!0,replace:!0})},e.prototype.startSync=function(){return console.log("starting dropbox sync"),I.emit("dropbox")},e}(d),b={},b.queue=f,b.all=n,b.dropbox=a,b.youtube=x,c=function(t){function e(){return this.selectPrevItem=q(this.selectPrevItem,this),this.selectNextItem=q(this.selectNextItem,this),this.selectedViewIndex=q(this.selectedViewIndex,this),this.render=q(this.render,this),e.__super__.constructor.apply(this,arguments)}return V(e,t),e.prototype.initialize=function(t){return e.__super__.initialize.call(this,t),this.subview(new l({delegate:this})),this.listenTo(this.collection,"reset add remove change",this.render),this.listenTo(P.router,"route",function(){return _.contains(["","trending"],Backbone.history.fragment)?this.$(".item:not(.explore)").removeClass("selected"):void 0}),this.$add=this.$(".add"),this.$builtInPlaylists=this.$("ul.builtin-playlists"),this.$userPlaylists=this.$("ul.user-playlists"),this.$exploreList=this.$("section.explore ul"),this.$exploreList.append(this.subview("explore-item",new p).render().el),this.$exploreList.append(this.subview("search-item",new y).render().el),this.collection.each(function(t){return function(e){var r;return e instanceof g?void 0:"queue"===e.id?t.$exploreList.append(t.subview("queue",new f({model:e}).render()).el):(w=b[e.id],r=t.subview("builtin-playlist-"+e.id,new w({model:e})).render(),t.$builtInPlaylists.append(r.el))}}(this))},e.prototype.render=function(){var t,e,r,n;for(n=this.subviews,e=0,r=n.length;r>e;e++)t=n[e],t.model instanceof g?t.remove():t.render();return this.collection.each(function(t){return function(e){var r;return e instanceof g?(r=t.subview("user-playlist-"+e.id,new d({model:e})),t.$userPlaylists.append(r.render().el)):void 0}}(this))},e.prototype.selectedViewIndex=function(){var t;return t=_.indexOf(this.subviews,_.find(this.subviews,function(t){return t.$el.is(".selected")})),console.log("selectedViewIndex",t),t},e.prototype.selectNextItem=function(){var t;return t=this.selectedViewIndex(),t<this.subviews.length-1?this.subviews[t+1].activate():void 0},e.prototype.selectPrevItem=function(){var t;return t=this.selectedViewIndex(),t>0?this.subviews[t-1].activate():void 0},e}(w),s=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return V(e,t),e.prototype.events={click:"click"},e.prototype.click=function(){return this.openDialog()},e.prototype.openDialog=function(t){var e;return(e=window.prompt("New Playlist Name:"))?P.user.library.playlists.create({name:e},{success:function(e){return P.user.library.playlists.selected(e),t?e.addTracks(t):void 0}}):void 0},e.prototype.drop=function(t){return this.openDialog(t)},e}(u),v=function(t){function e(){return this.toggleMenu=q(this.toggleMenu,this),this.setMenuPos=q(this.setMenuPos,this),e.__super__.constructor.apply(this,arguments)}return V(e,t),e.prototype.className="user",e.prototype.template=z,e.prototype.container="#header",e.prototype.events={"click img":"toggleMenu","click li":"toggleMenu"},e.prototype.initialize=function(t){return e.__super__.initialize.call(this,t),this.isOpen=!1,this.listenTo(this.model,"change reset",this.render)},e.prototype.render=function(){return e.__super__.render.apply(this,arguments),this.$menu=this.$(".menu"),this.setMenuPos(),this},e.prototype.setMenuPos=function(){var t;return t=this.isOpen?""+(this.$el.height()+1)+"px":""+(this.$el.height()-this.$menu.height())+"px",this.$menu.css("top",t)},e.prototype.toggleMenu=function(){return this.isOpen=!this.isOpen,this.setMenuPos()},e}(w),h=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return V(e,t),e.prototype.initialize=function(t){return e.__super__.initialize.call(this,t),this.subview("items",new c({collection:P.user.library.playlists,el:this.$el})).render(),this.subview("create-playlist",new s({el:this.$el.find(".create-playlist")})),this.subview("user",new v({model:P.user,el:this.$(".profile")})).render()},e}(i),r.exports=h}),require.register("views/ui/dnd",function(t,e,r){var n,i,s,o,a,u={}.hasOwnProperty,p=function(t,e){function r(){this.constructor=t}for(var n in e)u.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},l=function(t,e){return function(){return t.apply(e,arguments)}};n=e("jquery"),o=e("mvc").View,a=e("pubsub"),i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return p(e,t),e.prototype.events={},e.prototype.initialize=function(t){return e.__super__.initialize.call(this,t),t.draggableSelector||this.$el.attr("draggable","true"),this.events["dragstart "+(t.draggableSelector||"")]="_dragstart",this.delegateEvents()},e.prototype.getDragged=function(t){return this.options.delegate.getDragged(t)},e.prototype._dragstart=function(t){var e;return e=this.getDragged(t),console.log("dragstart",e),a._dragged=e},e}(o),s=function(t){function e(){return this.drop=l(this.drop,this),e.__super__.constructor.apply(this,arguments)}return p(e,t),e.prototype.events={},e.prototype.initialize=function(t){var r,n,i,s;if(e.__super__.initialize.call(this,t),r={dragover:"_dragover",dragenter:"_dragenter",dragleave:"_dragleave",drop:"_drop"},t.droppableSelector){i={};for(n in r)s=r[n],i[""+n+" "+t.droppableSelector]=s;r=i}return _.extend(this.events,r),this.delegateEvents()},e.prototype.drop=function(t,e){return this.options.delegate.drop(t,e)},e.prototype.draghover=function(t){var e;return n(t.currentTarget).addClass("draghover"),null!=(e=this.options.delegate)&&"function"==typeof e.draghover?e.draghover(t):void 0},e.prototype.dragleave=function(t){var e;return n(t.currentTarget).removeClass("draghover"),null!=(e=this.options.delegate)&&"function"==typeof e.dragleave?e.dragleave(t):void 0},e.prototype._dragover=function(t){return this.draghover(t),!1},e.prototype._dragenter=function(t){return this.draghover(t),!1},e.prototype._dragleave=function(t){return this.dragleave(t),!1},e.prototype._drop=function(t){var e;return console.log("_drop",t),e=a._dragged,a._dragged=null,e.getDragged&&(e=e.getDragged()),n.when(e).then(function(e){return function(r){return e.drop(r,t),e.dragleave(t)}}(this)),!1},e}(o),r.exports={DraggableView:i,DroppableView:s}}),require.register("views/ui/focus_context_view",function(t,e,r){var n,i,s,o,a,u,p,l=function(t,e){return function(){return t.apply(e,arguments)}},c={}.hasOwnProperty,h=function(t,e){function r(){this.constructor=t}for(var n in e)c.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};a=e("mvc").View,p=e("pubsub"),s=9,o=38,n=40,u=function(t){var e,r,n;return e=_.indexOf(i.instances,i.focused),r=i.instances.length-1,n=t.shiftKey?0>=e?r:e-1:e===r?0:e+1,$(":focus").blur(),p.publish("focuscontext:focus",i.instances[n]),!1},$(document).on("keydown",function(t){var e,r;switch(t.keyCode){case s:u(t);break;case o:null!=(e=i.focused)&&e.selectPrevItem();break;case n:null!=(r=i.focused)&&r.selectNextItem();break;default:return!0}return t.preventDefault(),!1}),i=function(t){function e(t){this.selectPrevItem=l(this.selectPrevItem,this),this.selectNextItem=l(this.selectNextItem,this),this.remove=l(this.remove,this),this.isFocused=l(this.isFocused,this),this.blur=l(this.blur,this),this.focus=l(this.focus,this),t.el||(t.el=t.delegate.el),e.__super__.constructor.call(this,t)}return h(e,t),e.instances=[],e.focused=null,e.prototype.events={mousedown:"handleMousedown"},e.prototype.initialize=function(t){return e.__super__.initialize.call(this,t),console.log("XXX",this.el),e.instances.push(this),this.$el.addClass("focuscontext"),this.listenTo(p,"focuscontext:focus",function(t){return function(e){return e===t?t.focus():t.blur()}}(this))},e.prototype.handleMousedown=function(){return p.publish("focuscontext:focus",this)},e.prototype.focus=function(){return e.focused=this,this.$el.addClass("focused")},e.prototype.blur=function(){return this.$el.removeClass("focused")},e.prototype.isFocused=function(){return this.$el.hasClass("focused")},e.prototype.remove=function(){return e.instances=_.without(e.instances,this),this.isFocused()&&(e.focused=null),e.__super__.remove.call(this)},e.prototype.selectNextItem=function(){return this.options.delegate.selectNextItem()},e.prototype.selectPrevItem=function(){return this.options.delegate.selectPrevItem()},e}(a),r.exports=i}),require.register("views/ui/lazy_renderer",function(t,e,r){var n,i,s,o=function(t,e){return function(){return t.apply(e,arguments)}};n=e("backbone"),s=function(){function t(t,e){this.start=t,this.end=e}return t.prototype.iter=function(){return _.range(this.start,this.end)},t.prototype.toString=function(){return"[Range start="+this.start+" end="+this.end+"]"},t}(),r.exports=i=function(){function t(t,e){this.viewport=t,this.collection=e,this.update=o(this.update,this),this.disengage=o(this.disengage,this),this.rowHeight=25,this.initial=100,this.extra=50,this.map=new Array(this.collection.length),this.rendered=0,this.update.debounced=_.debounce(this.update,200),this.viewport.on("scroll",this.update.debounced),$(window).on("resize",this.update.debounced)}return _.extend(t.prototype,n.Events),t.prototype.remove=function(){return this.viewport.html(""),this.disengage()},t.prototype.disengage=function(){return this.viewport.off("scroll",this.update.debounced),$(window).off("resize",this.update.debounced)},t.prototype.renderIntial=function(t){return t||(t=new s(0,Math.min(this.collection.length,this.initial))),this.collection.length?this.render(t):void 0},t.prototype.getVisibleRange=function(){var t,e;return t=Math.floor(this.viewport.scrollTop()/this.rowHeight),e=Math.ceil(this.viewport.outerHeight()/this.rowHeight),new s(t,Math.min(this.collection.length,t+e))},t.prototype.update=function(){var t,e;return e=this.getVisibleRange(),t=new s(Math.max(0,e.start-this.extra),Math.min(this.collection.length,e.end+this.extra)),this.ensureRendered(t)},t.prototype.ensureRendered=function(t){var e,r,n,i;for(r=this.getUnrenderedRanges(t),n=0,i=r.length;i>n;n++)e=r[n],this.render(e);return r.length?this.trigger("update"):void 0},t.prototype.getUnrenderedRanges=function(t){var e,r,n,i,o,a;for(n=null,r=[],a=t.iter(),i=0,o=a.length;o>i;i++)e=a[i],this.map[e]?n&&(r.push(n),n=null):n?n.end+=1:n=new s(e,e+1);return n&&r.push(n),r},t.prototype.render=function(t){var e,r,n,i,s,o,a,u,p,l,c;for(c=t.iter(),p=0,l=c.length;l>p;p++)n=c[p],this.map[n]=1,this.rendered++;return e=$(this.makeTable(t)),r=this.getGaps(t),this.rendered===this.collection.length&&this.disengage(),t.start>0&&(o=t.start-r.before,u=".item[data-track="+this.collection[o-1].cid+"]:first",a=this.viewport.find(u).parents("table:first"),a.css("margin-bottom",""),r.before&&e.css("margin-top",""+this.px(r.before)+"px")),s=t.end+r.after,s!==this.collection.length&&(u=".item[data-track="+this.collection[s].cid+"]:first",i=this.viewport.find(u).parents("table:first"),i.css("margin-top","")),r.after&&e.css("margin-bottom",""+this.px(r.after)+"px"),0!==t.start&&(null!=a?a.length:void 0)?a.after(e):this.viewport.prepend(e)},t.prototype.validate=function(){var t,e,r;return e=this.px(this.collection.length),t=this.viewport[0].scrollHeight,t>this.viewport.height()?void 0:(r="expected="+e+" actual="+t+" expected == actual: "+(e===t),e!==t?console.warn("invalid state: "+r):void 0)},t.prototype.getGaps=function(t){var e,r,n;for(r=0,e=0,n=t.start;--n>=0&&!this.map[n];)r++;for(n=t.end;!this.map[n]&&++n<=this.collection.length;)e++;return{before:r,after:e}},t.prototype.px=function(t){return t*this.rowHeight},t.prototype.makeTable=function(){throw""+this+": makeTable() not implemented"},t.prototype.addItem=function(t,e){var r,n,i,s,o,a;return this.map.splice(e,0,null),a=this.getVisibleRange(),this.map[e+1]?(i=$(this.makeRow(t)),s=this.collection[e+1],r=this.viewport.find(".item[data-track='"+s.cid+"']:first"),$(i).insertBefore(r),++this.rendered,this.map[e]=1):this.map[e-1]?(o=this.collection[e-1],n=this.viewport.find(".item[data-track='"+o.cid+"']:first"),i=$(this.makeRow(t)),$(i).insertAfter(n),this.map[e]=1,++this.rendered,this.viewport.scrollTop(this.viewport.scrollTop()+this.rowHeight)):a.start<=e&&e<=a.end?this.update():void 0},t.prototype.removeItem=function(t,e){var r,n;return n=this.map[e],this.map.splice(e,1),n&&(r=this.viewport.find(".item[data-track='"+t.cid+"']:first"),r.remove(),--this.rendered),this.trigger("update")},t.prototype.changeItem=function(){},t}()}),require.register("views/ui/menu_view",function(t,e,r){var n,i,s,o,a={}.hasOwnProperty,u=function(t,e){function r(){this.constructor=t}for(var n in e)a.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};s=e("mvc").View,o=e("templates/ui/menu_item"),n=function(t){function e(t){this.action=t.action,this.action.url&&(this.tagName="a",this.attributes={href:this.action.url}),e.__super__.constructor.call(this,t)}return u(e,t),e.prototype.className="item",e.prototype.template=o,e.prototype.events={click:"click"},e.prototype.click=function(){var t;return console.log("CLICKED",this),"function"==typeof(t=this.action).callback?t.callback():void 0},e.prototype.getTemplateData=function(){return this.action},e}(s),r.exports=i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return u(e,t),e.prototype.initialize=function(t){return e.__super__.initialize.call(this,t),this.actions=t.actions,t},e.prototype.render=function(){var t,e,r,i;i=this.actions;for(e in i)t=i[e],t=_.extend({id:e},t),r=this.subview(new n({action:t})),this.$el.append(r.render().el);return this},e.fromMouseEvent=function(t,r){var n,i;return t.stopPropagation(),i=new e(r).render(),n=$("#menu"),n.append(i.el).css({top:t.clientY+10,left:t.clientX-n.width()/2}).show().addClass("open"),$(document).one("click",function(){return console.log("REMOVEING"),n.removeClass("open"),n.one("transitionend",function(){return i.remove(),n.hide()})}),i},e}(s)}),require.register("views/ui/resizer_views",function(t,e,r){var n,i,s,o,a,u=function(t,e){return function(){return t.apply(e,arguments)}},p={}.hasOwnProperty,l=function(t,e){function r(){this.constructor=t}for(var n in e)p.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};a=e("mvc").View,i=function(t){function e(){return this.finish=u(this.finish,this),this.move=u(this.move,this),this.start=u(this.start,this),e.__super__.constructor.apply(this,arguments)}return l(e,t),e.prototype.dimension=null,e.prototype.cssProperty=null,e.prototype.eventProperty=null,e.prototype.events={mousedown:"start"},e.prototype.initialize=function(t){return e.__super__.initialize.call(this,t),this.$context=t.context,this.value=t.value,this.relative=t.relative,this.render()},e.prototype.start=function(t){return this.$el.addClass("active"),this.saveEventValue(t),$(window).on("mousemove",this.move),$(window).on("mouseup",this.finish),!1},e.prototype.move=function(t){var e,r,n,i,s;return n=this.eventValue,this.saveEventValue(t),s=this.getLimits(),r=s[0],e=s[1],i=this.getCurrentAbsoluteValue()-(n-this.eventValue),r>i?i=r:i>e&&(i=e),this.$el.css(this.cssProperty,i+"px")},e.prototype.finish=function(t){return this.saveEventValue(t),this.$el.removeClass("active"),$(window).off("mousemove",this.move),$(window).off("mouseup",this.finish),this.commit(),this.eventValue=null},e.prototype.commit=function(){return this.value=this.relative?this.getCurrentAbsoluteValue()/this.getContextSize()*100:this.getCurrentAbsoluteValue(),this.render(),this.trigger("resize",this.value)},e.prototype.getCSSValue=function(){return this.value+(this.relative?"%":"px")},e.prototype.getLimits=function(){var t,e;return e=null!=this.options.min?this.options.min:0,t=this.options.max?this.options.max<0?this.getContextSize()+this.options.max:this.options.max:this.getContextSize(),[e,t]},e.prototype.getContextSize=function(){return this.$context[this.dimension]()},e.prototype.saveEventValue=function(t){return this.eventValue=t[this.eventProperty]},e.prototype.render=function(){return this.$el.css(this.cssProperty,this.getCSSValue()),this},e.prototype.getCurrentAbsoluteValue=function(){return parseInt(this.$el.css(this.cssProperty),10)},e}(a),n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return l(e,t),e.prototype.eventProperty="pageX",e.prototype.cssProperty="left",e.prototype.dimension="width",e}(i),s=function(t){function e(){return this.saveEventValue=u(this.saveEventValue,this),e.__super__.constructor.apply(this,arguments)}return l(e,t),e.prototype.eventProperty=null,e.prototype.cssProperty="right",e.prototype.dimension="width",e.prototype.saveEventValue=function(t){return this.eventValue=Math.abs(t.pageX-this.getContextSize())},e}(i),o=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return l(e,t),e.prototype.eventProperty="pageY",e.prototype.cssProperty="top",e.prototype.dimension="height",e}(i),r.exports={ColumnResizer:n,RightBoundColumnResizer:s,RowResizer:o}}),require.register("views/ui/slider_view",function(t,e,r){var n,i,s=function(t,e){return function(){return t.apply(e,arguments)}},o={}.hasOwnProperty,a=function(t,e){function r(){this.constructor=t}for(var n in e)o.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};i=e("mvc").View,r.exports=n=function(t){function e(){return this.finish=s(this.finish,this),this.move=s(this.move,this),this.start=s(this.start,this),this.render=s(this.render,this),e.__super__.constructor.apply(this,arguments)}return a(e,t),e.prototype.events={mousedown:"start"},e.prototype.initialize=function(t){return e.__super__.initialize.call(this,t),this.$pos=this.$(".pos"),this.$elapsed=this.$(".elapsed"),this.listenTo(this.model,"change:"+this.field,this.render)},e.prototype.render=function(){var t;return t=this.positionFromValue(),this.$pos.css("left",""+t+"px"),this.$elapsed.css("width",""+(t+4)+"px"),this},e.prototype.getBounds=function(){var t,e,r,n;return n=this.$el.width(),r=this.$pos.width(),e=0,t=n-r,{min:e,max:t,positionWidth:r}},e.prototype.positionFromValue=function(){var t,e,r;return r=this.getBounds(),e=r.min,t=r.max,(t-e)/100*this.model[this.field]()},e.prototype.valueFromPosition=function(){var t,e,r,n;return r=parseInt(this.$pos.css("left"),10),n=this.getBounds(),e=n.min,t=n.max,Math.round(r/(t-e)*100)},e.prototype.start=function(t){return this.$el.addClass("active"),$(window).on("mousemove",this.move),$(window).on("mouseup",this.finish),this.move(t),!1},e.prototype.positionFromEvent=function(t){var e,r,n,i,s,o;return e=this.$el.offset().left,o=this.getBounds(),n=o.min,r=o.max,s=o.positionWidth,i=t.pageX-s/2,Math.max(n,Math.min(r,i-n-e))},e.prototype.move=function(t){var e;return e=this.positionFromEvent(t),this.$pos.css("left",""+e+"px"),this.$elapsed.css("width",""+(e+4)+"px"),this.setValue()},e.prototype.setValue=function(){var t;return t=this.valueFromPosition(),this.model[this.field](t)},e.prototype.finish=function(){return this.$el.removeClass("active"),$(window).off("mousemove",this.move),$(window).off("mouseup",this.finish),this.setValue()},e}(i)});